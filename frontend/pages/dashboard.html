<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOARC - Dashboard</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <header class="header">
        <div class="header-content">
            <a href="dashboard.html" class="logo">DOARC</a>
            <div class="user-menu">
                <span class="user-name" id="userName">Volunt√°rio</span>
                <button class="btn-logout" id="logoutBtn">Sair</button>
            </div>
        </div>
    </header>

    <nav class="nav">
        <ul class="nav-list">
            <li class="nav-item">
                <a href="dashboard.html" class="nav-link active">Dashboard</a>
            </li>
            <li class="nav-item" id="adminNav" style="display: none;">
                <a href="admin-dashboard.html" class="nav-link">Dashboard Admin</a>
            </li>
<<<<<<< HEAD
            
            <li class="nav-item">
                <a href="minha-area.html" class="nav-link">Minha √Årea</a>
            </li>

=======
>>>>>>> f920d7edf7db4e47bf74d5fa54468951ca65c13a
            <li class="nav-item">
                <a href="#" class="nav-link">Gerenciar</a>
                <ul class="submenu">
                    <li class="submenu-item"><a href="gerenciar-doadores.html" class="submenu-link">Doadores</a></li>
                    <li class="submenu-item"><a href="gerenciar-donatarios.html" class="submenu-link">Donat√°rios</a></li>
                    <li class="submenu-item"><a href="gerenciar-produtos.html" class="submenu-link">Produtos</a></li>
                    <li class="submenu-item"><a href="gerenciar-categorias.html" class="submenu-link">Categorias</a></li>
                    <li class="submenu-item"><a href="gerenciar-voluntarios.html" class="submenu-link">Volunt√°rios</a></li>
                    <li class="submenu-item"><a href="gerenciar-campanhas.html" class="submenu-link">Campanhas</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link">Doa√ß√µes</a>
                <ul class="submenu">
                    <li class="submenu-item"><a href="receber-doacoes.html" class="submenu-link">Receber Doa√ß√µes</a></li>
                    <li class="submenu-item"><a href="efetuar-doacoes.html" class="submenu-link">Efetuar Doa√ß√µes</a></li>
                    <li class="submenu-item"><a href="agendar-doacao.html" class="submenu-link">Agendar Doa√ß√£o</a></li>
                    <li class="submenu-item"><a href="agendar-retirada.html" class="submenu-link">Agendar Retirada</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link">Estoque</a>
                <ul class="submenu">
                    <li class="submenu-item"><a href="visualizar-estoque.html" class="submenu-link">Visualizar Estoque</a></li>
                    <li class="submenu-item"><a href="registrar-acerto.html" class="submenu-link">Acerto de Estoque</a></li>
                    <li class="submenu-item"><a href="lancar-compra.html" class="submenu-link">Lan√ßar Compra/Arrecada√ß√£o</a></li>
                    <li class="submenu-item"><a href="agendar-higienizacao.html" class="submenu-link">Agendar Higieniza√ß√£o</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <a href="relatorios.html" class="nav-link">Relat√≥rios</a>
            </li>
        </ul>
    </nav>

    <main class="container">
        <div class="breadcrumb">
            <div class="breadcrumb-item active">Dashboard</div>
        </div>

        <h1 style="margin-bottom: 2rem; color: var(--primary-color);">Dashboard</h1>

<<<<<<< HEAD
=======
        <!-- User Info -->
>>>>>>> f920d7edf7db4e47bf74d5fa54468951ca65c13a
        <div class="card mb-4">
            <div class="card-body">
                <h3>Bem-vindo, <span id="userWelcome">Volunt√°rio</span>!</h3>
                <p>N√≠vel de acesso: <strong id="userLevel">USER</strong></p>
                <p>Status: <span class="badge badge-success">Ativo</span></p>
            </div>
        </div>

<<<<<<< HEAD
=======
        <!-- Statistics Cards -->
>>>>>>> f920d7edf7db4e47bf74d5fa54468951ca65c13a
        <div class="dashboard-grid">
            <div class="stat-card" style="background: linear-gradient(135deg, #3498db, #2980b9);">
                <div class="stat-icon">üì¶</div>
                <div class="stat-value" id="totalProdutos">0</div>
                <div class="stat-label">Produtos no Estoque</div>
            </div>

            <div class="stat-card" style="background: linear-gradient(135deg, #2ecc71, #27ae60);">
                <div class="stat-icon">‚¨áÔ∏è</div>
                <div class="stat-value" id="doacoesRecebidas">0</div>
                <div class="stat-label">Doa√ß√µes Recebidas (M√™s)</div>
            </div>

            <div class="stat-card" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">
                <div class="stat-icon">‚¨ÜÔ∏è</div>
                <div class="stat-value" id="doacoesEfetuadas">0</div>
                <div class="stat-label">Doa√ß√µes Efetuadas (M√™s)</div>
            </div>

            <div class="stat-card" style="background: linear-gradient(135deg, #f39c12, #d68910);">
                <div class="stat-icon">ü§ù</div>
                <div class="stat-value" id="voluntariosAtivos">0</div>
                <div class="stat-label">Volunt√°rios Ativos</div>
            </div>

            <div class="stat-card" style="background: linear-gradient(135deg, #9b59b6, #8e44ad);">
                <div class="stat-icon">üìã</div>
                <div class="stat-value" id="campanhasAtivas">0</div>
                <div class="stat-label">Campanhas Ativas</div>
            </div>

            <div class="stat-card" style="background: linear-gradient(135deg, #1abc9c, #16a085);">
                <div class="stat-icon">üë•</div>
                <div class="stat-value" id="donatariosAtivos">0</div>
                <div class="stat-label">Donat√°rios Ativos</div>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-header">
                <h2 class="card-title">A√ß√µes R√°pidas</h2>
            </div>
            <div class="card-body">
                <div class="btn-group">
                    <a href="receber-doacoes.html" class="btn btn-success">
                        ‚¨áÔ∏è Receber Doa√ß√£o
                    </a>
                    <a href="efetuar-doacoes.html" class="btn btn-danger">
                        ‚¨ÜÔ∏è Efetuar Doa√ß√£o
                    </a>
                    <a href="agendar-doacao.html" class="btn btn-info">
                        üìÖ Agendar Doa√ß√£o
                    </a>
                    <a href="visualizar-estoque.html" class="btn btn-primary">
                        üì¶ Ver Estoque
                    </a>
                    <a href="relatorios.html" class="btn btn-warning">
                        üìä Relat√≥rios
                    </a>
                </div>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-header">
                <h2 class="card-title">Atividades Recentes</h2>
            </div>
            <div class="card-body">
                <div class="table-container">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Tipo</th>
                                <th>Descri√ß√£o</th>
                                <th>Volunt√°rio</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="atividadesRecentes">
                            <tr>
                                <td colspan="5" class="text-center" style="padding: 2rem; color: var(--text-light);">
                                    Nenhuma atividade recente
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

<<<<<<< HEAD
=======
        <!-- Volunt√°rios List (for authenticated users) -->
>>>>>>> f920d7edf7db4e47bf74d5fa54468951ca65c13a
        <div class="card mt-4">
            <div class="card-header">
                <h2 class="card-title">Lista de Volunt√°rios</h2>
                <button class="btn btn-primary" onclick="loadVoluntarios()">üîÑ Atualizar</button>
            </div>
            <div class="card-body">
                <div id="voluntariosList">
                    <p class="text-center">Carregue a lista de volunt√°rios...</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Scripts -->
    <script src="../js/auth.js"></script>
    <script src="../js/api.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar autentica√ß√£o
            if (!Auth.checkAuth()) {
                return;
            }

            // Carregar dados do usu√°rio
            const user = Auth.getUser();
            if (user) {
<<<<<<< HEAD
                // Mostrar nome do volunt√°rio (ou email se nome n√£o dispon√≠vel)
                const displayName = user.nome || user.email;
                document.getElementById('userName').textContent = displayName;
                document.getElementById('userWelcome').textContent = displayName;

                // Mostrar n√≠vel de acesso
                document.getElementById('userLevel').textContent = user.nivelAcesso;

                // Mostrar link admin se for admin
                if (Auth.isAdmin()) {
=======
                document.getElementById('userName').textContent = user.email;
                document.getElementById('userWelcome').textContent = user.email;
                document.getElementById('userLevel').textContent = user.nivelAcesso;
                
                // Mostrar link admin se for admin
                if (user.nivelAcesso === 'ADMIN') {
>>>>>>> f920d7edf7db4e47bf74d5fa54468951ca65c13a
                    document.getElementById('adminNav').style.display = 'block';
                }
            }

<<<<<<< HEAD
                // Debug info
                console.log('üë§ Usu√°rio:', displayName);
                console.log('üîë N√≠vel de acesso:', user.nivelAcesso);
                console.log('üëë √â admin?', Auth.isAdmin());
            }

=======
>>>>>>> f920d7edf7db4e47bf74d5fa54468951ca65c13a
            // Configurar logout
            document.getElementById('logoutBtn').addEventListener('click', function() {
                if (confirm('Deseja realmente sair?')) {
                    Auth.logout();
                }
            });

            // Carregar dados iniciais
            loadDashboardData();
        });

        // Carregar dados do dashboard
        function loadDashboardData() {
            // Dados simulados - integrar com API real posteriormente
            document.getElementById('totalProdutos').textContent = '150';
            document.getElementById('doacoesRecebidas').textContent = '45';
            document.getElementById('doacoesEfetuadas').textContent = '32';
            document.getElementById('voluntariosAtivos').textContent = '12';
            document.getElementById('campanhasAtivas').textContent = '3';
            document.getElementById('donatariosAtivos').textContent = '78';

            // Simular atividades recentes
            const atividades = [
                {
                    data: '14/11/2025',
                    tipo: 'Doa√ß√£o Recebida',
                    descricao: 'Recebimento de 50kg de alimentos',
                    voluntario: 'Jo√£o Silva',
                    status: 'Conclu√≠do'
                },
                {
                    data: '13/11/2025',
                    tipo: 'Doa√ß√£o Efetuada',
                    descricao: 'Distribui√ß√£o de cestas b√°sicas',
                    voluntario: 'Maria Santos',
                    status: 'Conclu√≠do'
                }
            ];

            const tbody = document.getElementById('atividadesRecentes');
            if (atividades.length > 0) {
                tbody.innerHTML = atividades.map(ativ => `
                    <tr>
                        <td>${ativ.data}</td>
                        <td>${ativ.tipo}</td>
                        <td>${ativ.descricao}</td>
                        <td>${ativ.voluntario}</td>
                        <td><span class="badge badge-success">${ativ.status}</span></td>
                    </tr>
                `).join('');
            }
        }

        // Carregar lista de volunt√°rios
        async function loadVoluntarios() {
            const voluntariosList = document.getElementById('voluntariosList');
            
            try {
                voluntariosList.innerHTML = '<p class="text-center">Carregando volunt√°rios...</p>';
                
<<<<<<< HEAD
                // Ajustado para usar a rota p√∫blica de equipe se n√£o for admin
                // Se for admin, usa a rota completa. O backend (VoluntarioView) agora tem /equipe
                const isAdmin = Auth.isAdmin();
                const endpoint = isAdmin ? '/admin/voluntarios' : '/voluntario/equipe';
                
                const data = await API.get(endpoint);
                
                // O endpoint /admin/voluntarios retorna lista direta, 
                // mas o c√≥digo original esperava {voluntarios: [], total: 0}
                // Vamos normalizar:
                let lista = Array.isArray(data) ? data : (data.voluntarios || []);
                
                if (lista.length > 0) {
                    voluntariosList.innerHTML = `
                        <p><strong>Total de volunt√°rios:</strong> ${lista.length}</p>
                        <div class="row">
                            ${lista.map(vol => `
=======
                const data = await API.voluntario.listar();
                
                if (data.voluntarios && data.voluntarios.length > 0) {
                    voluntariosList.innerHTML = `
                        <p><strong>Total de volunt√°rios:</strong> ${data.total}</p>
                        <div class="row">
                            ${data.voluntarios.map(vol => `
>>>>>>> f920d7edf7db4e47bf74d5fa54468951ca65c13a
                                <div class="col-md-4 mb-3">
                                    <div class="card">
                                        <div class="card-body">
                                            <h6>${vol.vol_nome || vol.nome || 'Nome n√£o informado'}</h6>
                                            <p class="text-muted">${vol.vol_email || vol.email || 'Email n√£o informado'}</p>
<<<<<<< HEAD
                                            <small>Tel: ${vol.vol_telefone || vol.telefone || '-'}</small>
=======
                                            <small>ID: ${vol.vol_id || vol.id}</small>
>>>>>>> f920d7edf7db4e47bf74d5fa54468951ca65c13a
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                } else {
                    voluntariosList.innerHTML = '<p class="text-center">Nenhum volunt√°rio encontrado.</p>';
                }
                
            } catch (error) {
                console.error('Erro ao carregar volunt√°rios:', error);
                voluntariosList.innerHTML = '<p class="text-center text-danger">Erro ao carregar volunt√°rios.</p>';
            }
        }
    </script>
</body>
</html>