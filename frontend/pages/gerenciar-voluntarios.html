<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOARC - Gerenciar Volunt√°rios</title>
    <link rel="stylesheet" href="../css/style.css">
    <script src="https://unpkg.com/vanilla-masker@1.2.0/lib/vanilla-masker.js"></script>
    <style>
        /* Estilos b√°sicos para garantir funcionamento */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); }
        .modal-content { background-color: #fefefe; margin: 5% auto; padding: 0; border-radius: 8px; width: 90%; max-width: 600px; }
        .modal-header { padding: 1rem 1.5rem; border-bottom: 1px solid #dee2e6; display: flex; justify-content: between; align-items: center; }
        .modal-body { padding: 1.5rem; max-height: 70vh; overflow-y: auto; }
        .modal-footer { padding: 1rem 1.5rem; border-top: 1px solid #dee2e6; display: flex; justify-content: flex-end; gap: 0.5rem; }
        .modal-close { background: none; border: none; font-size: 1.5rem; cursor: pointer; }
        .form-row { display: flex; gap: 1rem; margin-bottom: 1rem; }
        .form-group { flex: 1; }
        .form-label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
        .form-control { width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; }
        .form-select { width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; background-color: white; }
        .btn { padding: 0.5rem 1rem; border: none; border-radius: 4px; cursor: pointer; text-decoration: none; display: inline-block; }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-outline { background-color: transparent; border: 1px solid #ddd; color: #333; }
        .btn-sm { padding: 0.25rem 0.5rem; font-size: 0.875rem; }
        .btn-info { background-color: #17a2b8; color: white; }
        .btn-warning { background-color: #ffc107; color: black; }
        .btn-danger { background-color: #dc3545; color: white; }
        .table { width: 100%; border-collapse: collapse; }
        .table th, .table td { padding: 0.75rem; border-bottom: 1px solid #dee2e6; text-align: left; }
        .table-striped tbody tr:nth-child(odd) { background-color: #f8f9fa; }
        .badge { padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem; }
        .badge-success { background-color: #28a745; color: white; }
        .text-center { text-align: center; }
        .required::after { content: " *"; color: red; }
        .form-error { color: red; font-size: 0.875rem; margin-top: 0.25rem; display: none; }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <a href="dashboard.html" class="logo">DOARC</a>
            <div class="user-menu">
                <span class="user-name" id="userName">Volunt√°rio</span>
                <button class="btn-logout" id="logoutBtn">Sair</button>
            </div>
        </div>
    </header>

    <nav class="nav">
        <ul class="nav-list">
            <li class="nav-item"><a href="dashboard.html" class="nav-link">Dashboard</a></li>
            <li class="nav-item">
                <a href="#" class="nav-link active">Gerenciar</a>
                <ul class="submenu">
                    <li class="submenu-item"><a href="gerenciar-doadores.html" class="submenu-link">Doadores</a></li>
                    <li class="submenu-item"><a href="gerenciar-donatarios.html" class="submenu-link">Donat√°rios</a></li>
                    <li class="submenu-item"><a href="gerenciar-produtos.html" class="submenu-link">Produtos</a></li>
                    <li class="submenu-item"><a href="gerenciar-categorias.html" class="submenu-link">Categorias</a></li>
                    <li class="submenu-item"><a href="gerenciar-voluntarios.html" class="submenu-link">Volunt√°rios</a></li>
                    <li class="submenu-item"><a href="gerenciar-campanhas.html" class="submenu-link">Campanhas</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link">Doa√ß√µes</a>
                <ul class="submenu">
                    <li class="submenu-item"><a href="receber-doacoes.html" class="submenu-link">Receber Doa√ß√µes</a></li>
                    <li class="submenu-item"><a href="efetuar-doacoes.html" class="submenu-link">Efetuar Doa√ß√µes</a></li>
                    <li class="submenu-item"><a href="agendar-doacao.html" class="submenu-link">Agendar Doa√ß√£o</a></li>
                    <li class="submenu-item"><a href="agendar-retirada.html" class="submenu-link">Agendar Retirada</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link">Estoque</a>
                <ul class="submenu">
                    <li class="submenu-item"><a href="visualizar-estoque.html" class="submenu-link">Visualizar Estoque</a></li>
                    <li class="submenu-item"><a href="registrar-acerto.html" class="submenu-link">Acerto de Estoque</a></li>
                    <li class="submenu-item"><a href="lancar-compra.html" class="submenu-link">Lan√ßar Compra/Arrecada√ß√£o</a></li>
                    <li class="submenu-item"><a href="agendar-higienizacao.html" class="submenu-link">Agendar Higieniza√ß√£o</a></li>
                </ul>
            </li>
            <li class="nav-item"><a href="relatorios.html" class="nav-link">Relat√≥rios</a></li>
        </ul>
    </nav>

    <main class="container">
        <div class="breadcrumb">
            <div class="breadcrumb-item"><a href="dashboard.html">Dashboard</a></div>
            <div class="breadcrumb-item">Gerenciar</div>
            <div class="breadcrumb-item active">Volunt√°rios</div>
        </div>

        <div class="card">
            <div class="card-header">
                <h1 class="card-title">Gerenciar Volunt√°rios</h1>
                <p class="card-subtitle">Cadastre e gerencie os volunt√°rios da organiza√ß√£o</p>
            </div>
            <div class="card-body">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem;">
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <input type="text" id="searchInput" class="form-control" placeholder="Buscar volunt√°rio..." style="max-width: 300px;">
                        <select id="filtroStatus" class="form-control form-select" style="max-width: 150px;">
                            <option value="">Todos Status</option>
                            <option value="ativo">Ativo</option>
                            <option value="inativo">Inativo</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="openModal('modalVoluntario')">‚ûï Novo Volunt√°rio</button>
                </div>

                <div class="table-container">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>CPF</th>
                                <th>E-mail</th>
                                <th>Telefone</th>
                                <th>Data Cadastro</th>
                                <th>Doa√ß√µes Realizadas</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="tabelaVoluntarios">
                            <!-- Os dados ser√£o carregados via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal para Cadastro/Edi√ß√£o de Volunt√°rios -->
    <div id="modalVoluntario" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Novo Volunt√°rio</h2>
                <button class="modal-close" onclick="closeModal('modalVoluntario')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="formVoluntario">
                    <input type="hidden" id="voluntarioId">
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="vol_nome" class="form-label required">Nome Completo</label>
                            <input type="text" id="vol_nome" class="form-control" required>
                            <div class="form-error">Nome √© obrigat√≥rio</div>
                        </div>
                        <div class="form-group">
                            <label for="vol_cpf" class="form-label required">CPF</label>
                            <input type="text" id="vol_cpf" class="form-control" required>
                            <div class="form-error">CPF inv√°lido</div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="vol_email" class="form-label required">E-mail</label>
                            <input type="email" id="vol_email" class="form-control" required>
                            <div class="form-error">E-mail inv√°lido</div>
                        </div>
                        <div class="form-group">
                            <label for="vol_telefone" class="form-label required">Telefone</label>
                            <input type="tel" id="vol_telefone" class="form-control" required>
                            <div class="form-error">Telefone inv√°lido</div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="vol_dataNasc" class="form-label required">Data de Nascimento</label>
                            <input type="date" id="vol_dataNasc" class="form-control" required>
                            <div class="form-error">Data √© obrigat√≥ria</div>
                        </div>
                        <div class="form-group">
                            <label for="vol_sexo" class="form-label required">Sexo</label>
                            <select id="vol_sexo" class="form-control form-select" required>
                                <option value="M">Masculino</option>
                                <option value="F">Feminino</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="vol_rua" class="form-label required">Rua</label>
                            <input type="text" id="vol_rua" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="vol_numero" class="form-label required">N√∫mero</label>
                            <input type="text" id="vol_numero" class="form-control" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="vol_bairro" class="form-label required">Bairro</label>
                            <input type="text" id="vol_bairro" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="vol_cidade" class="form-label required">Cidade</label>
                            <input type="text" id="vol_cidade" class="form-control" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="vol_cep" class="form-label required">CEP</label>
                            <input type="text" id="vol_cep" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="vol_uf" class="form-label required">UF</label>
                            <select id="vol_uf" class="form-control form-select" required>
                                <option value="">Selecione um estado</option>
                                <option value="AC">Acre</option>
                                <option value="AL">Alagoas</option>
                                <option value="AP">Amap√°</option>
                                <option value="AM">Amazonas</option>
                                <option value="BA">Bahia</option>
                                <option value="CE">Cear√°</option>
                                <option value="DF">Distrito Federal</option>
                                <option value="ES">Esp√≠rito Santo</option>
                                <option value="GO">Goi√°s</option>
                                <option value="MA">Maranh√£o</option>
                                <option value="MT">Mato Grosso</option>
                                <option value="MS">Mato Grosso do Sul</option>
                                <option value="MG">Minas Gerais</option>
                                <option value="PA">Par√°</option>
                                <option value="PB">Para√≠ba</option>
                                <option value="PR">Paran√°</option>
                                <option value="PE">Pernambuco</option>
                                <option value="PI">Piau√≠</option>
                                <option value="RJ">Rio de Janeiro</option>
                                <option value="RN">Rio Grande do Norte</option>
                                <option value="RS">Rio Grande do Sul</option>
                                <option value="RO">Rond√¥nia</option>
                                <option value="RR">Roraima</option>
                                <option value="SC">Santa Catarina</option>
                                <option value="SP">S√£o Paulo</option>
                                <option value="SE">Sergipe</option>
                                <option value="TO">Tocantins</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                            <label for="vol_observacoes" class="form-label">Observa√ß√µes</label>
                            <textarea id="vol_observacoes" class="form-control" rows="3" 
                                    placeholder="Digite aqui observa√ß√µes relevantes sobre o volunt√°rio..."></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('modalVoluntario')">Cancelar</button>
                <button class="btn btn-primary" onclick="salvarVoluntario()">Salvar</button>
            </div>
        </div>
    </div>

    <!-- Modal para Hist√≥rico -->
    <div id="modalHistorico" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Hist√≥rico de Doa√ß√µes</h2>
                <button class="modal-close" onclick="closeModal('modalHistorico')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Tipo</th>
                                <th>Descri√ß√£o</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="tabelaHistorico">
                            <tr><td colspan="4" class="text-center">Carregando...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('modalHistorico')">Fechar</button>
            </div>
        </div>
    </div>

    <script>
        // Inicializa√ß√£o das m√°scaras de input
        document.addEventListener('DOMContentLoaded', function() {
            // M√°scara para CEP
            VMasker(document.querySelector("#vol_cep")).maskPattern("99999-999");

            // M√°scara para telefone (aceita 8 ou 9 d√≠gitos para o n√∫mero)
            const phoneInput = document.querySelector("#vol_telefone");
            if (phoneInput) {
                VMasker(phoneInput).maskPattern("(99) 9999-99999");
                phoneInput.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\D/g, '');
                    if (value.length > 10) {
                        VMasker(phoneInput).maskPattern("(99) 99999-9999");
                    } else {
                        VMasker(phoneInput).maskPattern("(99) 9999-99999");
                    }
                });
            }
        });

        // Simula√ß√£o das fun√ß√µes UI que devem estar no app.js
        const UI = {
            openModal: (modalId) => {
                document.getElementById(modalId).style.display = 'block';
            },
            closeModal: (modalId) => {
                document.getElementById(modalId).style.display = 'none';
            },
            showAlert: (message, type) => {
                alert(`${type.toUpperCase()}: ${message}`);
            },
            confirm: (message, callback) => {
                if (confirm(message)) {
                    callback();
                }
            }
        };

        // Simula√ß√£o do Validator que deve estar no app.js
        const Validator = {
            isEmpty: (value) => !value || value.trim() === '',
            isValidCPF: (cpf) => {
                const cleanCPF = cpf.replace(/[^\d]/g, '');
                return cleanCPF.length === 11;
            },
            isValidEmail: (email) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email),
            isValidPhone: (phone) => {
                const cleanPhone = phone.replace(/[^\d]/g, '');
                return cleanPhone.length >= 10 && cleanPhone.length <= 11;
            },
            showError: (input, message) => {
                const errorElement = input.nextElementSibling;
                if (errorElement && errorElement.classList.contains('form-error')) {
                    errorElement.textContent = message;
                    errorElement.style.display = 'block';
                    input.style.borderColor = 'red';
                }
            },
            clearAllErrors: (form) => {
                const errors = form.querySelectorAll('.form-error');
                const inputs = form.querySelectorAll('.form-control');
                errors.forEach(error => error.style.display = 'none');
                inputs.forEach(input => input.style.borderColor = '');
            }
        };

        // FUN√á√ïES GLOBAIS (acess√≠veis pelo HTML)
        function openModal(modalId) {
            if (modalId === 'modalVoluntario') {
                document.getElementById('formVoluntario').reset();
                document.getElementById('voluntarioId').value = '';
                document.getElementById('modalTitle').textContent = 'Novo Volunt√°rio';
            }
            UI.openModal(modalId);
        }

        function closeModal(modalId) { 
            UI.closeModal(modalId); 
        }

        function editarVoluntario(id) {
            // Buscar dados do volunt√°rio para edi√ß√£o
            fetch(`http://localhost:8080/apis/voluntario/${id}`)
                .then(response => response.json())
                .then(vol => {
                    document.getElementById('voluntarioId').value = vol.id;
                    document.getElementById('modalTitle').textContent = 'Editar Volunt√°rio';
                    document.getElementById('vol_nome').value = vol.nome || '';
                    document.getElementById('vol_cpf').value = vol.cpf || '';
                    document.getElementById('vol_email').value = vol.email || '';
                    document.getElementById('vol_telefone').value = vol.telefone || '';
                    document.getElementById('vol_dataNasc').value = vol.dataNasc || '';
                    document.getElementById('vol_sexo').value = vol.sexo || 'M';
                    document.getElementById('vol_rua').value = vol.rua || '';
                    document.getElementById('vol_numero').value = vol.numero || '';
                    document.getElementById('vol_bairro').value = vol.bairro || '';
                    document.getElementById('vol_cidade').value = vol.cidade || '';
                    document.getElementById('vol_cep').value = vol.cep || '';
                    document.getElementById('vol_uf').value = vol.uf || 'SP';
                    
                    openModal('modalVoluntario');
                })
                .catch(error => {
                    console.error('Erro ao carregar volunt√°rio:', error);
                    UI.showAlert('Erro ao carregar dados do volunt√°rio', 'error');
                });
        }

        function verHistorico(id) {
            document.getElementById('tabelaHistorico').innerHTML = `
                <tr>
                    <td>10/10/2025</td>
                    <td>Recebimento</td>
                    <td>Recebeu 50kg de arroz</td>
                    <td><span class="badge badge-success">Conclu√≠do</span></td>
                </tr>
                <tr>
                    <td>05/10/2025</td>
                    <td>Distribui√ß√£o</td>
                    <td>Distribuiu 10 cestas b√°sicas</td>
                    <td><span class="badge badge-success">Conclu√≠do</span></td>
                </tr>
            `;
            openModal('modalHistorico');
        }

        function toggleStatus(id) {
            UI.confirm('Deseja alterar o status deste volunt√°rio?', async function() {
                try {
                    // Simula√ß√£o de altera√ß√£o de status
                    UI.showAlert('Status atualizado!', 'success');
                } catch (error) {
                    console.error('Erro:', error);
                    UI.showAlert('Erro ao atualizar status', 'error');
                }
            });
        }

        async function carregarVoluntarios() {
            try {
                console.log('Iniciando carregamento de volunt√°rios...');
                const response = await fetch('http://localhost:8080/apis/voluntario', {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                console.log('Resposta do servidor:', {
                    status: response.status,
                    statusText: response.statusText,
                    headers: Object.fromEntries(response.headers.entries())
                });
                
                // L√™ a resposta como texto primeiro
                const responseText = await response.text();
                console.log('Resposta como texto:', responseText);
                
                // Tenta converter para JSON
                let responseData;
                try {
                    responseData = JSON.parse(responseText);
                } catch (e) {
                    console.error('Erro ao converter resposta para JSON:', e);
                    throw new Error('Resposta do servidor n√£o √© um JSON v√°lido');
                }

                // Se temos uma mensagem de "nenhum volunt√°rio encontrado", mostramos a tabela vazia
                if (response.status === 400 && responseData.mensagem === "Nenhum volunt√°rio encontrado.") {
                    const tbody = document.getElementById('tabelaVoluntarios');
                    tbody.innerHTML = '<tr><td colspan="8" class="text-center">Nenhum volunt√°rio cadastrado</td></tr>';
                    return;
                }

                // Se h√° outro erro, lan√ßamos exce√ß√£o
                if (!response.ok) {
                    console.error('Erro na requisi√ß√£o GET:', {
                        status: response.status,
                        statusText: response.statusText,
                        body: responseText
                    });
                    throw new Error(`Erro ao carregar volunt√°rios: ${responseText}`);
                }

                // Se chegou aqui, temos dados de volunt√°rios
                const voluntarios = Array.isArray(responseData) ? responseData : 
                                  responseData.data ? responseData.data : [];

                console.log('Volunt√°rios carregados:', voluntarios);
                const tbody = document.getElementById('tabelaVoluntarios');
                console.log('Elemento tbody encontrado:', tbody !== null);
                tbody.innerHTML = '';
                
                if (voluntarios.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="8" class="text-center">Nenhum volunt√°rio cadastrado</td></tr>';
                    return;
                }
                
                voluntarios.forEach(vol => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${vol.nome || 'N/A'}</td>
                        <td>${vol.cpf || 'N/A'}</td>
                        <td>${vol.email || 'N/A'}</td>
                        <td>${vol.telefone || 'N/A'}</td>
                        <td>${new Date().toLocaleDateString('pt-BR')}</td>
                        <td>0</td>
                        <td><span class="badge badge-success">Ativo</span></td>
                        <td>
                            <button class="btn btn-sm btn-info" onclick="editarVoluntario(${vol.id})">‚úèÔ∏è</button>
                            <button class="btn btn-sm btn-warning" onclick="verHistorico(${vol.id})">üìã</button>
                            <button class="btn btn-sm btn-danger" onclick="toggleStatus(${vol.id})">üîí</button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (error) {
                console.error('Erro ao carregar volunt√°rios:', error);
                document.getElementById('tabelaVoluntarios').innerHTML = 
                    '<tr><td colspan="8" class="text-center">Erro ao carregar dados</td></tr>';
            }
        }

        async function salvarVoluntario() {
            const form = document.getElementById('formVoluntario');
            const vol_nome = document.getElementById('vol_nome');
            const vol_cpf = document.getElementById('vol_cpf');
            const vol_email = document.getElementById('vol_email');
            const vol_telefone = document.getElementById('vol_telefone');
            const vol_dataNasc = document.getElementById('vol_dataNasc');

            Validator.clearAllErrors(form);
            let isValid = true;

            // Valida√ß√µes
            if (Validator.isEmpty(vol_nome.value)) {
                Validator.showError(vol_nome, 'Nome √© obrigat√≥rio');
                isValid = false;
            }
            if (Validator.isEmpty(vol_cpf.value) || !Validator.isValidCPF(vol_cpf.value)) {
                Validator.showError(vol_cpf, 'CPF inv√°lido');
                isValid = false;
            }
            if (Validator.isEmpty(vol_email.value) || !Validator.isValidEmail(vol_email.value)) {
                Validator.showError(vol_email, 'E-mail inv√°lido');
                isValid = false;
            }
            if (Validator.isEmpty(vol_telefone.value) || !Validator.isValidPhone(vol_telefone.value)) {
                Validator.showError(vol_telefone, 'Telefone inv√°lido');
                isValid = false;
            }
            if (Validator.isEmpty(vol_dataNasc.value)) {
                Validator.showError(vol_dataNasc, 'Data √© obrigat√≥ria');
                isValid = false;
            }

            if (!isValid) return;

            try {
                const voluntarioId = document.getElementById('voluntarioId').value;
                
                // Cria FormData para enviar como @RequestParam
                const formData = new FormData();
                formData.append('vol_nome', vol_nome.value);
                formData.append('vol_cpf', vol_cpf.value.replace(/[^\d]/g, ''));
                formData.append('vol_email', vol_email.value);
                formData.append('vol_telefone', vol_telefone.value.replace(/[^\d]/g, ''));
                formData.append('vol_dataNasc', vol_dataNasc.value);
                formData.append('vol_sexo', document.getElementById('vol_sexo').value);
                formData.append('vol_rua', document.getElementById('vol_rua').value);
                formData.append('vol_numero', document.getElementById('vol_numero').value);
                formData.append('vol_bairro', document.getElementById('vol_bairro').value);
                formData.append('vol_cidade', document.getElementById('vol_cidade').value);
                formData.append('vol_cep', document.getElementById('vol_cep').value.replace(/[^\d]/g, ''));
                formData.append('vol_uf', document.getElementById('vol_uf').value);

                // Log dos dados que ser√£o enviados
                console.log('Enviando dados para o servidor...');
                for (let [key, value] of formData.entries()) {
                    console.log(`${key}: ${value}`);
                }

                let response;
                if (voluntarioId) {
                    // Edi√ß√£o - adiciona o ID e usa PUT
                    formData.append('vol_id', voluntarioId);
                    response = await fetch('http://localhost:8080/apis/voluntario', {
                        method: 'PUT',
                        body: formData
                    });
                } else {
                    // Cadastro - usa POST
                    console.log('Iniciando POST para cadastro de volunt√°rio');
                    try {
                        response = await fetch('http://localhost:8080/apis/voluntario', {
                            method: 'POST',
                            body: formData
                        });
                        
                        if (!response.ok) {
                            const errorText = await response.text();
                            console.error('Erro na resposta do servidor:', response.status, errorText);
                            throw new Error(`Erro do servidor: ${response.status} - ${errorText}`);
                        }
                    } catch (error) {
                        console.error('Erro detalhado do POST:', error);
                        throw error;
                    }
                }

                console.log('Resposta bruta do servidor:', response);
                
                // Tenta ler a resposta como texto primeiro
                const responseText = await response.text();
                console.log('Resposta do servidor como texto:', responseText);
                
                let result;
                try {
                    // Tenta converter para JSON se poss√≠vel
                    result = responseText ? JSON.parse(responseText) : {};
                    console.log('Resposta convertida para JSON:', result);
                } catch (e) {
                    console.log('Resposta n√£o √© JSON v√°lido:', responseText);
                    result = { mensagem: responseText };
                }

                if (response.ok) {
                    console.log('Salvamento bem-sucedido, resultado:', result);
                    UI.showAlert(voluntarioId ? 'Volunt√°rio atualizado!' : 'Volunt√°rio cadastrado!', 'success');
                    closeModal('modalVoluntario');
                    
                    // Pequena pausa antes de recarregar
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    await carregarVoluntarios();
                } else {
                    console.error('Erro na requisi√ß√£o:', {
                        status: response.status,
                        statusText: response.statusText,
                        headers: Object.fromEntries(response.headers.entries()),
                        body: responseText
                    });
                    const errorMessage = result.mensagem || responseText || 'Erro desconhecido';
                    UI.showAlert('Erro no servidor: ' + errorMessage, 'error');
                }
                
            } catch (error) {
                console.error('Erro completo:', {
                    message: error.message,
                    stack: error.stack,
                    error: error
                });
                UI.showAlert('Erro ao salvar volunt√°rio: ' + (error.message || 'Erro desconhecido'), 'error');
            }
        }

        // EVENT LISTENERS (dentro do DOMContentLoaded)
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('searchInput').addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                const rows = document.querySelectorAll('#tabelaVoluntarios tr');
                rows.forEach(row => {
                    row.style.display = row.textContent.toLowerCase().includes(searchTerm) ? '' : 'none';
                });
            });

            document.getElementById('filtroStatus').addEventListener('change', function() {
                const status = this.value.toLowerCase();
                const rows = document.querySelectorAll('#tabelaVoluntarios tr');
                rows.forEach(row => {
                    if (!status || row.textContent.toLowerCase().includes(status)) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                });
            });

            // Carrega os volunt√°rios quando a p√°gina abre
            carregarVoluntarios();
        });
    </script>
</body>
</html>