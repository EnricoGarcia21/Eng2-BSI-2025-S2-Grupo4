<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOARC - Gerenciar Volunt√°rios</title>
    <link rel="stylesheet" href="../css/style.css">
    <script src="https://unpkg.com/vanilla-masker@1.2.0/lib/vanilla-masker.js"></script>
    <style>
        /* Estilos b√°sicos para garantir funcionamento */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); }
        .modal-content { background-color: #fefefe; margin: 5% auto; padding: 0; border-radius: 8px; width: 90%; max-width: 600px; }
        .modal-header { padding: 1rem 1.5rem; border-bottom: 1px solid #dee2e6; display: flex; justify-content: between; align-items: center; }
        .modal-body { padding: 1.5rem; max-height: 70vh; overflow-y: auto; }
        .modal-footer { padding: 1rem 1.5rem; border-top: 1px solid #dee2e6; display: flex; justify-content: flex-end; gap: 0.5rem; }
        .modal-close { background: none; border: none; font-size: 1.5rem; cursor: pointer; }
        .form-row { display: flex; gap: 1rem; margin-bottom: 1rem; }
        .form-group { flex: 1; }
        .form-label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
        .form-control { width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; }
        .form-select { width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; background-color: white; }
        .btn { padding: 0.5rem 1rem; border: none; border-radius: 4px; cursor: pointer; text-decoration: none; display: inline-block; }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-outline { background-color: transparent; border: 1px solid #ddd; color: #333; }
        .btn-sm { padding: 0.25rem 0.5rem; font-size: 0.875rem; }
        .btn-info { background-color: #17a2b8; color: white; }
        .btn-warning { background-color: #ffc107; color: black; }
        .btn-danger { background-color: #dc3545; color: white; }
        .btn-secondary { background-color: #6c757d; color: white; }
        .table { width: 100%; border-collapse: collapse; }
        .table th, .table td { padding: 0.75rem; border-bottom: 1px solid #dee2e6; text-align: left; }
        .table-striped tbody tr:nth-child(odd) { background-color: #f8f9fa; }
        .badge { padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem; }
        .badge-success { background-color: #28a745; color: white; }
        .badge-danger { background-color: #dc3545; color: white; }
        .text-center { text-align: center; }
        .required::after { content: " *"; color: red; }
        .form-error { color: red; font-size: 0.875rem; margin-top: 0.25rem; display: none; }
        .action-buttons { display: flex; gap: 0.25rem; }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <a href="dashboard.html" class="logo">DOARC</a>
            <div class="user-menu">
                <span class="user-name" id="userName">Volunt√°rio</span>
                <button class="btn-logout" id="logoutBtn">Sair</button>
            </div>
        </div>
    </header>

    <nav class="nav">
        <ul class="nav-list">
            <li class="nav-item"><a href="dashboard.html" class="nav-link">Dashboard</a></li>
            <li class="nav-item">
                <a href="#" class="nav-link active">Gerenciar</a>
                <ul class="submenu">
                    <li class="submenu-item"><a href="gerenciar-doadores.html" class="submenu-link">Doadores</a></li>
                    <li class="submenu-item"><a href="gerenciar-donatarios.html" class="submenu-link">Donat√°rios</a></li>
                    <li class="submenu-item"><a href="gerenciar-produtos.html" class="submenu-link">Produtos</a></li>
                    <li class="submenu-item"><a href="gerenciar-categorias.html" class="submenu-link">Categorias</a></li>
                    <li class="submenu-item"><a href="gerenciar-voluntarios.html" class="submenu-link">Volunt√°rios</a></li>
                    <li class="submenu-item"><a href="gerenciar-campanhas.html" class="submenu-link">Campanhas</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link">Doa√ß√µes</a>
                <ul class="submenu">
                    <li class="submenu-item"><a href="receber-doacoes.html" class="submenu-link">Receber Doa√ß√µes</a></li>
                    <li class="submenu-item"><a href="efetuar-doacoes.html" class="submenu-link">Efetuar Doa√ß√µes</a></li>
                    <li class="submenu-item"><a href="agendar-doacao.html" class="submenu-link">Agendar Doa√ß√£o</a></li>
                    <li class="submenu-item"><a href="agendar-retirada.html" class="submenu-link">Agendar Retirada</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link">Estoque</a>
                <ul class="submenu">
                    <li class="submenu-item"><a href="visualizar-estoque.html" class="submenu-link">Visualizar Estoque</a></li>
                    <li class="submenu-item"><a href="registrar-acerto.html" class="submenu-link">Acerto de Estoque</a></li>
                    <li class="submenu-item"><a href="lancar-compra.html" class="submenu-link">Lan√ßar Compra/Arrecada√ß√£o</a></li>
                    <li class="submenu-item"><a href="agendar-higienizacao.html" class="submenu-link">Agendar Higieniza√ß√£o</a></li>
                </ul>
            </li>
            <li class="nav-item"><a href="relatorios.html" class="nav-link">Relat√≥rios</a></li>
        </ul>
    </nav>

    <main class="container">
        <div class="breadcrumb">
            <div class="breadcrumb-item"><a href="dashboard.html">Dashboard</a></div>
            <div class="breadcrumb-item">Gerenciar</div>
            <div class="breadcrumb-item active">Volunt√°rios</div>
        </div>

        <div class="card">
            <div class="card-header">
                <h1 class="card-title">Gerenciar Volunt√°rios</h1>
                <p class="card-subtitle">Cadastre e gerencie os volunt√°rios da organiza√ß√£o</p>
            </div>
            <div class="card-body">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem;">
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <input type="text" id="searchInput" class="form-control" placeholder="Buscar volunt√°rio..." style="max-width: 300px;">
                        <select id="filtroStatus" class="form-control form-select" style="max-width: 150px;">
                            <option value="">Todos Status</option>
                            <option value="ativo">Ativo</option>
                            <option value="inativo">Inativo</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="openModal('modalVoluntario')">‚ûï Novo Volunt√°rio</button>
                </div>

                <div class="table-container">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>CPF</th>
                                <th>E-mail</th>
                                <th>Telefone</th>
                                <th>Data Cadastro</th>
                                <th>Doa√ß√µes Realizadas</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="tabelaVoluntarios">
                            <!-- Os dados ser√£o carregados via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal para Cadastro/Edi√ß√£o de Volunt√°rios -->
    <div id="modalVoluntario" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Novo Volunt√°rio</h2>
                <button class="modal-close" onclick="closeModal('modalVoluntario')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="formVoluntario">
                    <input type="hidden" id="voluntarioId">
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="vol_nome" class="form-label required">Nome Completo</label>
                            <input type="text" id="vol_nome" class="form-control" required>
                            <div class="form-error">Nome √© obrigat√≥rio</div>
                        </div>
                        <div class="form-group">
                            <label for="vol_cpf" class="form-label required">CPF</label>
                            <input type="text" id="vol_cpf" class="form-control" required>
                            <div class="form-error">CPF inv√°lido</div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="vol_email" class="form-label required">E-mail</label>
                            <input type="email" id="vol_email" class="form-control" required>
                            <div class="form-error">E-mail inv√°lido</div>
                        </div>
                        <div class="form-group">
                            <label for="vol_telefone" class="form-label required">Telefone</label>
                            <input type="tel" id="vol_telefone" class="form-control" required>
                            <div class="form-error">Telefone inv√°lido</div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="vol_dataNasc" class="form-label required">Data de Nascimento</label>
                            <input type="date" id="vol_dataNasc" class="form-control" required>
                            <div class="form-error">Data √© obrigat√≥ria</div>
                        </div>
                        <div class="form-group">
                            <label for="vol_sexo" class="form-label required">Sexo</label>
                            <select id="vol_sexo" class="form-control form-select" required>
                                <option value="M">Masculino</option>
                                <option value="F">Feminino</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="vol_rua" class="form-label required">Rua</label>
                            <input type="text" id="vol_rua" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="vol_numero" class="form-label required">N√∫mero</label>
                            <input type="text" id="vol_numero" class="form-control" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="vol_bairro" class="form-label required">Bairro</label>
                            <input type="text" id="vol_bairro" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="vol_cidade" class="form-label required">Cidade</label>
                            <input type="text" id="vol_cidade" class="form-control" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="vol_cep" class="form-label required">CEP</label>
                            <input type="text" id="vol_cep" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="vol_uf" class="form-label required">UF</label>
                            <select id="vol_uf" class="form-control form-select" required>
                                <option value="">Selecione um estado</option>
                                <option value="AC">Acre</option>
                                <option value="AL">Alagoas</option>
                                <option value="AP">Amap√°</option>
                                <option value="AM">Amazonas</option>
                                <option value="BA">Bahia</option>
                                <option value="CE">Cear√°</option>
                                <option value="DF">Distrito Federal</option>
                                <option value="ES">Esp√≠rito Santo</option>
                                <option value="GO">Goi√°s</option>
                                <option value="MA">Maranh√£o</option>
                                <option value="MT">Mato Grosso</option>
                                <option value="MS">Mato Grosso do Sul</option>
                                <option value="MG">Minas Gerais</option>
                                <option value="PA">Par√°</option>
                                <option value="PB">Para√≠ba</option>
                                <option value="PR">Paran√°</option>
                                <option value="PE">Pernambuco</option>
                                <option value="PI">Piau√≠</option>
                                <option value="RJ">Rio de Janeiro</option>
                                <option value="RN">Rio Grande do Norte</option>
                                <option value="RS">Rio Grande do Sul</option>
                                <option value="RO">Rond√¥nia</option>
                                <option value="RR">Roraima</option>
                                <option value="SC">Santa Catarina</option>
                                <option value="SP">S√£o Paulo</option>
                                <option value="SE">Sergipe</option>
                                <option value="TO">Tocantins</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                            <label for="vol_observacoes" class="form-label">Observa√ß√µes</label>
                            <textarea id="vol_observacoes" class="form-control" rows="3" 
                                    placeholder="Digite aqui observa√ß√µes relevantes sobre o volunt√°rio..."></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('modalVoluntario')">Cancelar</button>
                <button class="btn btn-primary" onclick="salvarVoluntario()">Salvar</button>
            </div>
        </div>
    </div>

    <!-- Modal para Hist√≥rico -->
    <div id="modalHistorico" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Hist√≥rico de Doa√ß√µes</h2>
                <button class="modal-close" onclick="closeModal('modalHistorico')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Tipo</th>
                                <th>Descri√ß√£o</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="tabelaHistorico">
                            <tr><td colspan="4" class="text-center">Carregando...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('modalHistorico')">Fechar</button>
            </div>
        </div>
    </div>
<script>
    // Vari√°vel global para armazenar os volunt√°rios
    let voluntariosData = [];

    // Configura√ß√£o espec√≠fica para esta p√°gina
    const VOLUNTARIOS_CONFIG = {
        BASE_URL: 'http://localhost:8080/apis/voluntario',
        HEADERS: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
        }
    };

    // Sistema de Autentica√ß√£o SIMPLES para esta p√°gina
    const Auth = {
        getUserName() {
            // Tenta pegar do localStorage (seu sistema atual)
            const userData = localStorage.getItem('doarc_user');
            if (userData) {
                try {
                    const user = JSON.parse(userData);
                    return user.nome || user.username || 'Volunt√°rio';
                } catch (e) {
                    console.error('Erro ao parsear user data:', e);
                }
            }
            
            // Tenta pegar do sessionStorage (alternativo)
            const sessionUser = sessionStorage.getItem('userName');
            if (sessionUser) return sessionUser;
            
            // Valor padr√£o
            return 'Volunt√°rio';
        },

       logout() {
            // Limpa todos os poss√≠veis storages
            localStorage.removeItem('doarc_user');
            localStorage.removeItem('user');
            localStorage.removeItem('token');
            localStorage.removeItem('loggedIn');
            sessionStorage.clear();
            
    // Redireciona para login (INDEX)
         window.location.href = '../index.html'; // ‚Üê Volta para raiz
}
    };

    // Inicializa√ß√£o da p√°gina
    document.addEventListener('DOMContentLoaded', function() {
        // 1. Atualiza o nome do usu√°rio no header
        atualizarUsuarioHeader();
        
        // 2. Configura o bot√£o de logout
        configurarLogout();
        
        // 3. Inicializa m√°scaras
        inicializarMascaras();
        
        // 4. Configura event listeners
        inicializarEventListeners();
        
        // 5. Carrega os volunt√°rios
        carregarVoluntarios();
    });

    // ===== FUN√á√ïES DE USU√ÅRIO =====
    function atualizarUsuarioHeader() {
        const userNameElement = document.getElementById('userName');
        if (userNameElement) {
            userNameElement.textContent = Auth.getUserName();
        }
    }

    function configurarLogout() {
        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', function(e) {
                e.preventDefault();
                if (confirm('Deseja realmente sair do sistema?')) {
                    Auth.logout();
                }
            });
        }
    }

    // ===== FUN√á√ïES DE M√ÅSCARAS =====
    function inicializarMascaras() {
        // M√°scara para CEP
        const cepInput = document.querySelector("#vol_cep");
        if (cepInput) {
            VMasker(cepInput).maskPattern("99999-999");
        }

        // M√°scara para CPF
        const cpfInput = document.querySelector("#vol_cpf");
        if (cpfInput) {
            VMasker(cpfInput).maskPattern("999.999.999-99");
        }

        // M√°scara para telefone
        const phoneInput = document.querySelector("#vol_telefone");
        if (phoneInput) {
            VMasker(phoneInput).maskPattern("(99) 9999-99999");
            phoneInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length > 10) {
                    VMasker(phoneInput).maskPattern("(99) 99999-9999");
                } else {
                    VMasker(phoneInput).maskPattern("(99) 9999-99999");
                }
            });
        }
    }

    // ===== FUN√á√ïES DE UI =====
    const UI = {
        openModal: (modalId) => {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'block';
            }
        },
        closeModal: (modalId) => { 
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
            }
        },
        showAlert: (message, type = 'info') => {
            alert(`${type.toUpperCase()}: ${message}`);
        },
        confirm: (message, callback) => {
            if (confirm(message)) {
                callback();
            }
        }
    };

    // ===== FUN√á√ïES DE VALIDA√á√ÉO =====
    const Validator = {
        isEmpty: (value) => !value || value.trim() === '',
        isValidCPF: (cpf) => {
            const cleanCPF = cpf.replace(/[^\d]/g, '');
            return cleanCPF.length === 11;
        },
        isValidEmail: (email) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email),
        isValidPhone: (phone) => {
            const cleanPhone = phone.replace(/[^\d]/g, '');
            return cleanPhone.length >= 10 && cleanPhone.length <= 11;
        },
        showError: (input, message) => {
            const errorElement = input.nextElementSibling;
            if (errorElement && errorElement.classList.contains('form-error')) {
                errorElement.textContent = message;
                errorElement.style.display = 'block';
                input.style.borderColor = 'red';
            }
        },
        clearAllErrors: (form) => {
            const errors = form.querySelectorAll('.form-error');
            const inputs = form.querySelectorAll('.form-control');
            errors.forEach(error => error.style.display = 'none');
            inputs.forEach(input => input.style.borderColor = '');
        }
    };

    // ===== FUN√á√ïES GLOBAIS (chamadas pelo HTML) =====
    function openModal(modalId) {
        if (modalId === 'modalVoluntario') {
            document.getElementById('formVoluntario').reset();
            document.getElementById('voluntarioId').value = '';
            document.getElementById('modalTitle').textContent = 'Novo Volunt√°rio';
            Validator.clearAllErrors(document.getElementById('formVoluntario'));
        }
        UI.openModal(modalId);
    }

    function closeModal(modalId) { 
        UI.closeModal(modalId); 
    }
    

    //AJUSTAR O EDITAR VOLUNTARIO, ao inves de editar ele cria um novo voluntario
    async function editarVoluntario(id) {
        try {
            
            const response = await fetch(`${VOLUNTARIOS_CONFIG.BASE_URL}/${id}`, {
                method: 'GET',
                headers: VOLUNTARIOS_CONFIG.HEADERS
            });

            if (!response.ok) {
                throw new Error(`Erro ${response.status}: ${response.statusText}`);
            }

            const vol = await response.json();
            
            // Preenche o formul√°rio com os dados
            document.getElementById('voluntarioId').value = vol.id;
            document.getElementById('modalTitle').textContent = 'Editar Volunt√°rio';
            document.getElementById('vol_nome').value = vol.nome || '';
            document.getElementById('vol_cpf').value = vol.cpf || '';
            document.getElementById('vol_email').value = vol.email || '';
            document.getElementById('vol_telefone').value = vol.telefone || '';
            document.getElementById('vol_dataNasc').value = vol.dataNasc ? vol.dataNasc.split('T')[0] : '';
            document.getElementById('vol_sexo').value = vol.sexo || 'M';
            document.getElementById('vol_rua').value = vol.rua || '';
            document.getElementById('vol_numero').value = vol.numero || '';
            document.getElementById('vol_bairro').value = vol.bairro || '';
            document.getElementById('vol_cidade').value = vol.cidade || '';
            document.getElementById('vol_cep').value = vol.cep || '';
            document.getElementById('vol_uf').value = vol.uf || '';
            document.getElementById('vol_observacoes').value = vol.observacoes || '';
            
            openModal('modalVoluntario');
        } catch (error) {
            console.error('Erro ao carregar volunt√°rio:', error);
            UI.showAlert('Erro ao carregar dados do volunt√°rio: ' + error.message, 'error');
        }
    }

    function verHistorico(id) {
        // Simula√ß√£o de hist√≥rico
        document.getElementById('tabelaHistorico').innerHTML = `
            <tr>
                <td>10/10/2025</td>
                <td>Recebimento</td>
                <td>Recebeu 50kg de arroz</td>
                <td><span class="badge badge-success">Conclu√≠do</span></td>
            </tr>
            <tr>
                <td>05/10/2025</td>
                <td>Distribui√ß√£o</td>
                <td>Distribuiu 10 cestas b√°sicas</td>
                <td><span class="badge badge-success">Conclu√≠do</span></td>
            </tr>
        `;
        openModal('modalHistorico');
    }

    async function toggleStatus(id) {
        const voluntario = voluntariosData.find(v => v.id === id);
        if (!voluntario) {
            UI.showAlert('Volunt√°rio n√£o encontrado', 'error');
            return;
        }

        const novoStatus = voluntario.status === 'ativo' ? 'inativo' : 'ativo';
        const acao = novoStatus === 'ativo' ? 'ativar' : 'inativar';
        
        UI.confirm(`Deseja ${acao} este volunt√°rio?`, async function() {
            try {
                //console.log(`Alterando status do volunt√°rio ${id} para: ${novoStatus}`);
                
                // ‚úÖ SOLU√á√ÉO FRONTEND - Status apenas na mem√≥ria
                voluntario.status = novoStatus;
                
                // Atualizar a interface
                atualizarInterfaceVoluntarios();
                
                UI.showAlert(`Volunt√°rio ${novoStatus === 'ativo' ? 'ativado' : 'inativado'} com sucesso!`, 'success');
                
            } catch (error) {
               // console.error('Erro ao alterar status:', error);
                UI.showAlert('Erro ao alterar status: ' + error.message, 'error');
            }
        });
    }

    async function excluirVoluntario(id) {
        UI.confirm('Tem certeza que deseja excluir este volunt√°rio? Esta a√ß√£o n√£o pode ser desfeita.', async function() {
            try {
                const response = await fetch(`${VOLUNTARIOS_CONFIG.BASE_URL}/${id}`, {
                    method: 'DELETE',
                    headers: VOLUNTARIOS_CONFIG.HEADERS
                });

                if (response.ok) {
                    voluntariosData = voluntariosData.filter(v => v.id !== id);
                    atualizarInterfaceVoluntarios();
                    UI.showAlert('Volunt√°rio exclu√≠do com sucesso!', 'success');
                } else {
                    throw new Error('Erro ao excluir volunt√°rio');
                }
            } catch (error) {
                //console.error('Erro:', error);
                UI.showAlert('Erro ao excluir volunt√°rio: ' + error.message, 'error');
            }
        });
    }

    function atualizarInterfaceVoluntarios() {
        const tbody = document.getElementById('tabelaVoluntarios');
        if (!tbody) return;
        
        tbody.innerHTML = '';
        
        if (voluntariosData.length === 0) {
            tbody.innerHTML = '<tr><td colspan="8" class="text-center">Nenhum volunt√°rio cadastrado</td></tr>';
            return;
        }
        
        voluntariosData.forEach(vol => {
            const row = document.createElement('tr');
            const isAtivo = vol.status === 'ativo';
            
            row.innerHTML = `
                <td>${vol.nome || 'N/A'}</td>
                <td>${vol.cpf || 'N/A'}</td>
                <td>${vol.email || 'N/A'}</td>
                <td>${vol.telefone || 'N/A'}</td>
                <td>${vol.dataCadastro ? new Date(vol.dataCadastro).toLocaleDateString('pt-BR') : new Date().toLocaleDateString('pt-BR')}</td>
                <td>${vol.doacoesRealizadas || 0}</td>
                <td>
                    <span class="badge ${isAtivo ? 'badge-success' : 'badge-danger'}">
                        ${isAtivo ? 'Ativo' : 'Inativo'}
                    </span>
                </td>
                <td>
                    <div class="action-buttons">
                        <button class="btn btn-sm btn-info" onclick="editarVoluntario(${vol.id})" title="Editar">‚úèÔ∏è</button>
                        <button class="btn btn-sm btn-warning" onclick="verHistorico(${vol.id})" title="Hist√≥rico">üìã</button>
                        <button class="btn btn-sm ${isAtivo ? 'btn-secondary' : 'btn-warning'}" onclick="toggleStatus(${vol.id})" title="${isAtivo ? 'Inativar' : 'Ativar'}">
                            ${isAtivo ? 'üîí' : 'üîì'}
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="excluirVoluntario(${vol.id})" title="Excluir">üóëÔ∏è</button>
                    </div>
                </td>
            `;
            tbody.appendChild(row);
        });
    }

    async function carregarVoluntarios() {
        try {
            //console.log('Iniciando carregamento de volunt√°rios...');
            const response = await fetch(VOLUNTARIOS_CONFIG.BASE_URL, {
                method: 'GET',
                headers: VOLUNTARIOS_CONFIG.HEADERS
            });

            console.log('Resposta do servidor:', {
                status: response.status,
                statusText: response.statusText
            });

            const responseText = await response.text();
           // console.log('Resposta como texto:', responseText);
            
            let responseData;
            try {
                responseData = JSON.parse(responseText);
            } catch (e) {
                //console.error('Erro ao converter resposta para JSON:', e);
                throw new Error('Resposta do servidor n√£o √© um JSON v√°lido');
            }

            // Tratamento de diferentes cen√°rios
            if (response.status === 400 && responseData.mensagem === "Nenhum volunt√°rio encontrado.") {
                voluntariosData = [];
                atualizarInterfaceVoluntarios();
                UI.showAlert('Nenhum volunt√°rio cadastrado no sistema.', 'info');
                return;
            }

            if (!response.ok) {
                console.error('Erro na requisi√ß√£o GET:', {
                    status: response.status,
                    statusText: response.statusText,
                    body: responseText
                });
                throw new Error(`Erro ao carregar volunt√°rios: ${responseData.mensagem || responseText}`);
            }

            // Processamento dos dados
            voluntariosData = Array.isArray(responseData) ? responseData : 
                            responseData.data ? responseData.data : [];

            console.log('Volunt√°rios carregados:', voluntariosData);
            
          
            voluntariosData.forEach(vol => {
                if (!vol.status) {
                    vol.status = 'ativo'; // Status padr√£o
                }
                if (!vol.doacoesRealizadas) {
                    vol.doacoesRealizadas = 0;
                }
            });

            atualizarInterfaceVoluntarios();
            
        } catch (error) {
            //console.error('Erro ao carregar volunt√°rios:', error);
            const tbody = document.getElementById('tabelaVoluntarios');
            if (tbody) {
                tbody.innerHTML = '<tr><td colspan="8" class="text-center">Erro ao carregar dados: ' + error.message + '</td></tr>';
            }
            UI.showAlert('Erro ao carregar volunt√°rios: ' + error.message, 'error');
        }
    }

    async function salvarVoluntario() {
        const form = document.getElementById('formVoluntario');
        const vol_nome = document.getElementById('vol_nome');
        const vol_cpf = document.getElementById('vol_cpf');
        const vol_email = document.getElementById('vol_email');
        const vol_telefone = document.getElementById('vol_telefone');
        const vol_dataNasc = document.getElementById('vol_dataNasc');

        Validator.clearAllErrors(form);
        let isValid = true;

        // Valida√ß√µes
        if (Validator.isEmpty(vol_nome.value)) {
            Validator.showError(vol_nome, 'Nome √© obrigat√≥rio');
            isValid = false;
        }
        if (Validator.isEmpty(vol_cpf.value) || !Validator.isValidCPF(vol_cpf.value)) {
            Validator.showError(vol_cpf, 'CPF inv√°lido');
            isValid = false;
        }
        if (Validator.isEmpty(vol_email.value) || !Validator.isValidEmail(vol_email.value)) {
            Validator.showError(vol_email, 'E-mail inv√°lido');
            isValid = false;
        }
        if (Validator.isEmpty(vol_telefone.value) || !Validator.isValidPhone(vol_telefone.value)) {
            Validator.showError(vol_telefone, 'Telefone inv√°lido');
            isValid = false;
        }
        if (Validator.isEmpty(vol_dataNasc.value)) {
            Validator.showError(vol_dataNasc, 'Data √© obrigat√≥ria');
            isValid = false;
        }

        if (!isValid) {
            UI.showAlert('Por favor, corrija os erros no formul√°rio', 'error');
            return;
        }

        try {
            const voluntarioId = document.getElementById('voluntarioId').value;
            
            // Cria FormData para enviar como @RequestParam
            const formData = new URLSearchParams();
            formData.append('vol_nome', vol_nome.value);
            formData.append('vol_cpf', vol_cpf.value.replace(/[^\d]/g, ''));
            formData.append('vol_email', vol_email.value);
            formData.append('vol_telefone', vol_telefone.value.replace(/[^\d]/g, ''));
            formData.append('vol_dataNasc', vol_dataNasc.value);
            formData.append('vol_sexo', document.getElementById('vol_sexo').value);
            formData.append('vol_rua', document.getElementById('vol_rua').value);
            formData.append('vol_numero', document.getElementById('vol_numero').value);
            formData.append('vol_bairro', document.getElementById('vol_bairro').value);
            formData.append('vol_cidade', document.getElementById('vol_cidade').value);
            formData.append('vol_cep', document.getElementById('vol_cep').value.replace(/[^\d]/g, ''));
            formData.append('vol_uf', document.getElementById('vol_uf').value);
            formData.append('vol_observacoes', document.getElementById('vol_observacoes').value);

           // console.log('Enviando dados como FormData:');
            for (let [key, value] of formData.entries()) {
                console.log(`${key}: ${value}`);
            }

            let response;
            let url = VOLUNTARIOS_CONFIG.BASE_URL;
            
            if (voluntarioId) {
                // Edi√ß√£o - adiciona o ID
                formData.append('vol_id', voluntarioId);
                response = await fetch(url, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: formData
                });
            } else {
                // Cadastro
                response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: formData
                });
            }

            console.log('Resposta do servidor:', {
                status: response.status,
                statusText: response.statusText
            });

            const responseText = await response.text();
           // console.log('Resposta como texto:', responseText);
            
            let result;
            try {
                result = responseText ? JSON.parse(responseText) : {};
            } catch (e) {
                result = { mensagem: responseText };
            }

            if (response.ok) {
                UI.showAlert(voluntarioId ? 'Volunt√°rio atualizado!' : 'Volunt√°rio cadastrado!', 'success');
                closeModal('modalVoluntario');
                await carregarVoluntarios();
            } else {
                const errorMessage = result.mensagem || responseText || 'Erro desconhecido';
                throw new Error(errorMessage);
            }
            
        } catch (error) {
            //console.error('Erro ao salvar volunt√°rio:', error);
            UI.showAlert('Erro ao salvar volunt√°rio: ' + error.message, 'error');
        }
    }

    // ===== EVENT LISTENERS =====
    function inicializarEventListeners() {
        // Bot√£o de logout
        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', function(e) {
                e.preventDefault();
                if (confirm('Deseja realmente sair do sistema?')) {
                    Auth.logout();
                }
            });
        }

        // Busca em tempo real
        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
            searchInput.addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                const rows = document.querySelectorAll('#tabelaVoluntarios tr');
                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    row.style.display = text.includes(searchTerm) ? '' : 'none';
                });
            });
        }

        // Filtro por status
        const filtroStatus = document.getElementById('filtroStatus');
        if (filtroStatus) {
            filtroStatus.addEventListener('change', function() {
                const status = this.value.toLowerCase();
                const rows = document.querySelectorAll('#tabelaVoluntarios tr');
                rows.forEach(row => {
                    if (!status) {
                        row.style.display = '';
                    } else {
                        const rowStatus = row.querySelector('.badge')?.textContent.toLowerCase();
                        row.style.display = rowStatus === status ? '' : 'none';
                    }
                });
            });
        }

        // Fechar modal ao clicar fora
        const modals = document.querySelectorAll('.modal');
        modals.forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal(this.id);
                }
            });
        });
    }
</script>
</body>
</html>