<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOARC - Agendar Doa√ß√£o</title>
    <link rel="stylesheet" href="../css/style.css">
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css' rel='stylesheet' />

    <style>
        .calendar-container {
            position: relative;
            width: 100%;
            min-height: 80vh;
        }
        .sidebar-form {
            position: fixed;
            top: 0;
            right: 0;
            width: 400px;
            height: 100%;
            background-color: #f8f9fa;
            box-shadow: -4px 0 10px rgba(0, 0, 0, 0.2);
            transform: translateX(100%);
            transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            z-index: 1050; 
            overflow-y: auto;
            padding: 20px;
            box-sizing: border-box;
        }
        .sidebar-form.open {
            transform: translateX(0);
        }
        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .sidebar-close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--danger-color);
        }
    </style>
</head>
<body>
<header class="header">
    <div class="header-content">
        <a href="dashboard.html" class="logo">DOARC</a>
        <div class="user-menu">
            <span class="user-name" id="userName">Volunt√°rio</span>
            <button class="btn-logout" id="logoutBtn">Sair</button>
        </div>
    </div>
</header>

<nav class="nav">
    <ul class="nav-list">
        <li class="nav-item">
            <a href="dashboard.html" class="nav-link">Dashboard</a>
        </li>
        <li class="nav-item">
            <a href="#" class="nav-link">Gerenciar</a>
            <ul class="submenu">
                <li class="submenu-item"><a href="gerenciar-doadores.html" class="submenu-link">Doadores</a></li>
                <li class="submenu-item"><a href="gerenciar-donatarios.html" class="submenu-link">Donat√°rios</a></li>
                <li class="submenu-item"><a href="gerenciar-produtos.html" class="submenu-link">Produtos</a></li>
                <li class="submenu-item"><a href="gerenciar-categorias.html" class="submenu-link">Categorias</a></li>
                <li class="submenu-item"><a href="gerenciar-voluntarios.html" class="submenu-link">Volunt√°rios</a></li>
                <li class="submenu-item"><a href="gerenciar-campanhas.html" class="submenu-link">Campanhas</a></li>
            </ul>
        </li>
        <li class="nav-item">
            <a href="#" class="nav-link active">Doa√ß√µes</a>
            <ul class="submenu">
                <li class="submenu-item"><a href="receber-doacoes.html" class="submenu-link">Receber Doa√ß√µes</a></li>
                <li class="submenu-item"><a href="efetuar-doacoes.html" class="submenu-link">Efetuar Doa√ß√µes</a></li>
                <li class="submenu-item"><a href="agendar-doacao.html" class="submenu-link">Agendar Doa√ß√£o</a></li>
                <li class="submenu-item"><a href="agendar-retirada.html" class="submenu-link">Agendar Retirada</a></li>
            </ul>
        </li>
        <li class="nav-item">
            <a href="#" class="nav-link">Estoque</a>
            <ul class="submenu">
                <li class="submenu-item"><a href="visualizar-estoque.html" class="submenu-link">Visualizar Estoque</a></li>
                <li class="submenu-item"><a href="registrar-acerto.html" class="submenu-link">Acerto de Estoque</a></li>
                <li class="submenu-item"><a href="lancar-compra.html" class="submenu-link">Lan√ßar Compra/Arrecada√ß√£o</a></li>
                <li class="submenu-item"><a href="agendar-higienizacao.html" class="submenu-link">Agendar Higieniza√ß√£o</a></li>
            </ul>
        </li>
        <li class="nav-item">
            <a href="relatorios.html" class="nav-link">Relat√≥rios</a>
        </li>
    </ul>
</nav>

<main class="container calendar-main">
    <div class="breadcrumb">
        <div class="breadcrumb-item"><a href="dashboard.html">Dashboard</a></div>
        <div class="breadcrumb-item">Doa√ß√µes</div>
        <div class="breadcrumb-item active">Agendar Doa√ß√£o</div>
    </div>

    <div class="card" style="margin-top: 0;">
        <div class="card-header">
            <h2 class="card-title">Calend√°rio de Agendamentos</h2>
            <p class="card-subtitle">Clique em um evento existente para Modificar ou Apagar.</p>
        </div>
        <div class="card-body calendar-container">
            <div id='calendar'></div>
        </div>
    </div>
</main>

<div id="formSidebar" class="sidebar-form">
    <div class="sidebar-header">
        <h1 class="card-title" id="formTitle">Detalhes do Agendamento</h1>
        <button class="sidebar-close-btn" onclick="closeSidebar()">‚úï</button>
    </div>

    <form id="formAgendarDoacao">
        <input type="hidden" id="agendamentoId" value="">

        <h3 style="color: var(--primary-color); margin-bottom: 1rem;">Tipo de Agendamento</h3>

        <div class="form-group">
            <label for="tipoAgendamento" class="form-label required">Tipo</label>
            <select id="tipoAgendamento" name="tipoAgendamento" class="form-control form-select" required onchange="toggleTipoAgendamento()">
                <option value="">Selecione o tipo</option>
                <option value="entrega">Entrega (levar para o donat√°rio)</option>
                <option value="retirada">Retirada (buscar do doador)</option>
            </select>
            <div class="form-error">Selecione o tipo de agendamento</div>
        </div>

        <h3 style="color: var(--primary-color); margin: 2rem 0 1rem;">Data e Hor√°rio</h3>

        <div class="form-row">
            <div class="form-group">
                <label for="dataAgendamento" class="form-label required">Data</label>
                <input type="date" id="dataAgendamento" name="agData" class="form-control" required>
                <div class="form-error">Data √© obrigat√≥ria</div>
            </div>

            <div class="form-group">
                <label for="horaAgendamento" class="form-label required">Hor√°rio</label>
                <input type="time" id="horaAgendamento" name="agHora" class="form-control" required>
                <div class="form-error">Hor√°rio √© obrigat√≥rio</div>
            </div>
        </div>

        <div id="secaoEntrega" style="display: none;">
            <h3 style="color: var(--primary-color); margin: 2rem 0 1rem;">Informa√ß√µes da Entrega</h3>

            <div class="form-group">
                <label for="donatarioEntrega" class="form-label required">Donat√°rio</label>
                <select id="donatarioEntrega" name="donatarioId" class="form-control form-select" required>
                    <option value="">Carregando...</option>
                </select>
                <div class="form-error">Selecione um donat√°rio</div>
            </div>

            <div class="form-group">
                <label for="enderecoEntrega" class="form-label">Endere√ßo de Entrega</label>
                <textarea id="enderecoEntrega" class="form-control" rows="2" placeholder="Endere√ßo preenchido automaticamente" readonly></textarea>
                <div class="form-error">Endere√ßo √© obrigat√≥rio</div>
            </div>
        </div>

        <div id="secaoRetirada" style="display: none;">
            <h3 style="color: var(--primary-color); margin: 2rem 0 1rem;">Informa√ß√µes da Retirada</h3>

            <div class="form-group">
                <label for="doadorRetirada" class="form-label required">Doador</label>
                <select id="doadorRetirada" name="doadorId" class="form-control form-select" required>
                    <option value="">Carregando...</option>
                </select>
                <div class="form-error">Selecione um doador</div>
            </div>

            <div class="form-group">
                <label for="enderecoRetirada" class="form-label">Local de Retirada</label>
                <textarea id="enderecoRetirada" class="form-control" rows="2" placeholder="Local preenchido automaticamente" readonly></textarea>
                <div class="form-error">Local √© obrigat√≥rio</div>
            </div>
        </div>

        <h3 style="color: var(--primary-color); margin: 2rem 0 1rem;">Respons√°vel</h3>

        <div class="form-group">
            <label for="voluntarioResponsavel" class="form-label required">Volunt√°rio Respons√°vel</label>
            <select id="voluntarioResponsavel" name="voluntarioId" class="form-control form-select" required>
                <option value="">Carregando...</option>
            </select>
            <div class="form-error">Selecione um volunt√°rio</div>
        </div>

        <h3 style="color: var(--primary-color); margin: 2rem 0 1rem;">Doa√ß√£o Relacionada</h3>

        <div class="form-group">
            <label for="doacaoDisponivel" class="form-label required">Doa√ß√£o (ID)</label>
            <select id="doacaoDisponivel" name="doaId" class="form-control form-select" required>
                <option value="">Selecione Tipo e Pessoa</option>
            </select>
            <div class="form-error">Selecione a doa√ß√£o a ser entregue/retirada</div>
        </div>

        <div id="listaProdutosAgendamento" style="margin-top: 1.5rem; display: none;">
            <h4>Produtos na Doa√ß√£o Selecionada:</h4>
            <div class="table-container">
                <table class="table">
                    <thead>
                    <tr>
                        <th>Produto</th>
                        <th>Quantidade</th>
                        <th>Observa√ß√£o</th>
                    </tr>
                    </thead>
                    <tbody id="tabelaProdutosAgendamento">
                    </tbody>
                </table>
            </div>
        </div>

        <h3 style="color: var(--primary-color); margin: 2rem 0 1rem;">Informa√ß√µes Adicionais</h3>

        <div class="form-group">
            <label for="observacoesAgendamento" class="form-label">Observa√ß√µes</label>
            <textarea id="observacoesAgendamento" name="agObs" class="form-control" rows="3" placeholder="Informa√ß√µes importantes sobre o agendamento..."></textarea>
        </div>

        <div class="card-footer" style="padding: 0; margin-top: 1rem;">
            <div class="btn-group" style="width: 100%;">
                <button type="button" class="btn btn-danger" id="btnApagar" style="flex: 1;" onclick="confirmarApagar()">
                    üóëÔ∏è Apagar Agendamento
                </button>
                <button type="submit" class="btn btn-success" id="btnModificar" style="flex: 1;">
                    üíæ Modificar Agendamento
                </button>
            </div>
        </div>
    </form>
</div>

<script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js'></script>
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/locales/pt-br.js'></script>
<script src="../js/app.js"></script>
<script>
    const API_BASE_URL = 'http://localhost:8080/apis';
    const hoje = new Date().toISOString().split('T')[0];
    document.getElementById('dataAgendamento').min = hoje;

    let dadosLookups = {
        voluntarios: [],
        donatarios: [],
        doadores: []
    };
    let calendarInstance;

    const getValue = (id) => {
        const value = document.getElementById(id).value;
        return (value === '' || value === null || value === '0') ? 0 : parseInt(value);
    };


    async function openSidebar(eventId) {
        const sidebar = document.getElementById('formSidebar');
        const form = document.getElementById('formAgendarDoacao');
        const agendamentoIdInput = document.getElementById('agendamentoId');

        const numericEventId = parseInt(eventId);

        form.reset();
        agendamentoIdInput.value = numericEventId;
        document.getElementById('formTitle').textContent = 'Carregando Detalhes...';
        sidebar.classList.add('open');

        try {
            const response = await fetch(`${API_BASE_URL}/agendamento/${numericEventId}`);
            if (!response.ok) throw new Error('Falha ao buscar agendamento');
            const dadosAgendamento = await response.json();

            document.getElementById('formTitle').textContent = `Editar: ID ${dadosAgendamento.id}`;

            document.getElementById('tipoAgendamento').value = dadosAgendamento.tipo || (dadosAgendamento.donatarioDonId ? 'entrega' : 'retirada');
            toggleTipoAgendamento(); 

            document.getElementById('dataAgendamento').value = dadosAgendamento.agData;
            document.getElementById('horaAgendamento').value = dadosAgendamento.agHora;

            document.getElementById('voluntarioResponsavel').value = dadosAgendamento.volId;
            document.getElementById('observacoesAgendamento').value = dadosAgendamento.agObs;

            if (dadosAgendamento.donatarioDonId) {
                document.getElementById('donatarioEntrega').value = dadosAgendamento.donatarioDonId;
                preencherEndereco('donatarioEntrega', 'enderecoEntrega', 'endereco');
            } else if (dadosAgendamento.doadorDoaId) {
                document.getElementById('doadorRetirada').value = dadosAgendamento.doadorDoaId;
                preencherEndereco('doadorRetirada', 'enderecoRetirada', 'local');
            }

            await carregarDoacoesDisponiveis(dadosAgendamento.doaId);
            document.getElementById('doacaoDisponivel').value = dadosAgendamento.doaId;
            atualizarDetalhesProdutos(dadosAgendamento.doaId);

        } catch (error) {
            console.error("Erro ao carregar agendamento:", error);
            UI.showAlert('Falha ao carregar detalhes do agendamento. Verifique se a rota /apis/agendamento/{id} est√° ativa.', 'danger');
            closeSidebar();
        }
    }

    function closeSidebar() {
        document.getElementById('formSidebar').classList.remove('open');
        document.getElementById('agendamentoId').value = '';
    }

    function toggleTipoAgendamento() {
        const tipo = document.getElementById('tipoAgendamento').value;
        document.getElementById('secaoEntrega').style.display = tipo === 'entrega' ? 'block' : 'none';
        document.getElementById('secaoRetirada').style.display = tipo === 'retirada' ? 'block' : 'none';
        document.getElementById('doacaoDisponivel').innerHTML = '<option value="0">Selecione Tipo e Pessoa</option>';
        document.getElementById('listaProdutosAgendamento').style.display = 'none';
    }

    async function carregarLookups() {
        const popularSelect = (id, lista, nomeProp, endProp) => {
            const select = document.getElementById(id);
            select.innerHTML = '<option value="0">Selecione</option>'; 
            
            if (lista && lista.length > 0) {
                lista.forEach(item => {
                    const option = document.createElement('option');
                    option.value = item.id;
                    option.textContent = item[nomeProp];
                    if (endProp) {
                        option.setAttribute('data-endereco', item[endProp]);
                    }
                    select.appendChild(option);
                });
            }
        };

        try {
            const [volResponse, donResponse, doaResponse] = await Promise.all([
                fetch(`${API_BASE_URL}/voluntario`).then(res => res.json()),
                fetch(`${API_BASE_URL}/donatario`).then(res => res.json()),
                fetch(`${API_BASE_URL}/doador`).then(res => res.json())
            ]);

            dadosLookups.voluntarios = Array.isArray(volResponse) ? volResponse.filter(v => v.nome && v.id) : [];
            dadosLookups.donatarios = Array.isArray(donResponse) ? donResponse.map(d => ({
                id: d.id,
                nome: d.nome,
                endereco: `${d.rua}, ${d.bairro}, ${d.cidade} - ${d.uf}`
            })).filter(d => d.nome && d.id) : [];

            dadosLookups.doadores = Array.isArray(doaResponse) ? doaResponse.map(d => ({
                id: d.id,
                nome: d.nome,
                local: `${d.rua}, ${d.bairro}, ${d.cidade} - ${d.uf}`
            })).filter(d => d.nome && d.id) : [];

        } catch (error) {
            console.error("Erro ao carregar lookups:", error);
            UI.showAlert('Falha ao carregar listas de Volunt√°rios/Doadores/Donat√°rios. Verifique se as rotas est√£o ativas e retornam 200 OK.', 'danger');
            
            document.getElementById('voluntarioResponsavel').innerHTML = '<option value="0">Erro de carregamento</option>';
            document.getElementById('donatarioEntrega').innerHTML = '<option value="0">Erro de carregamento</option>';
            document.getElementById('doadorRetirada').innerHTML = '<option value="0">Erro de carregamento</option>';
            return;
        }

        popularSelect('voluntarioResponsavel', dadosLookups.voluntarios, 'nome');
        popularSelect('donatarioEntrega', dadosLookups.donatarios, 'nome', 'endereco');
        popularSelect('doadorRetirada', dadosLookups.doadores, 'nome', 'local');
    }

    function preencherEndereco(selectId, textareaId, enderecoProp) {
        const select = document.getElementById(selectId);
        const textarea = document.getElementById(textareaId);
        const selectedOption = select.options[select.selectedIndex];
        
        if(select.value !== "0") {
           textarea.value = selectedOption.getAttribute('data-endereco') || '';
           Validator.clearError(textarea);
        } else {
           textarea.value = '';
        }
        
        carregarDoacoesDisponiveis();
    }

    async function carregarDoacoesDisponiveis(selectedDoaId = null) {
        const tipo = document.getElementById('tipoAgendamento').value;
        const pessoaSelect = tipo === 'entrega' ? document.getElementById('donatarioEntrega') : document.getElementById('doadorRetirada');
        const pessoaId = pessoaSelect.value;

        const selectDoacao = document.getElementById('doacaoDisponivel');
        selectDoacao.innerHTML = '<option value="0">Carregando...</option>';
        document.getElementById('listaProdutosAgendamento').style.display = 'none';
        selectDoacao.disabled = true;

        if (pessoaId === "0" || !tipo) {
            selectDoacao.innerHTML = '<option value="0">Selecione Tipo e Pessoa</option>';
            selectDoacao.disabled = false;
            return;
        }

        try {
            const response = await fetch(`${API_BASE_URL}/doacao/disponiveis?tipo=${tipo}&pessoaId=${pessoaId}`);
            
            if (response.status !== 200 && response.status !== 400) {
                 throw new Error(`Falha HTTP: ${response.status}`);
            }
            
            const doacoes = await response.json();

            selectDoacao.innerHTML = '<option value="0">Selecione a Doa√ß√£o</option>';
            if (Array.isArray(doacoes)) {
                doacoes.forEach(d => {
                    const option = document.createElement('option');
                    option.value = d.id;
                    option.textContent = `ID ${d.id}: ${d.obs || 'Doa√ß√£o sem observa√ß√£o'}`;
                    option.setAttribute('data-detalhes', JSON.stringify(d.produtos || []));
                    if (d.id == selectedDoaId) {
                        option.selected = true;
                    }
                    selectDoacao.appendChild(option);
                });
            }

            selectDoacao.onchange = () => atualizarDetalhesProdutos(null);
            selectDoacao.disabled = false;

        } catch (e) {
            console.error("Erro ao carregar doa√ß√µes dispon√≠veis:", e);
            UI.showAlert('Erro ao carregar doa√ß√µes dispon√≠veis. Rota /doacao/disponiveis falhou.', 'danger');
            selectDoacao.innerHTML = '<option value="0">Erro ao carregar doa√ß√µes</option>';
            selectDoacao.disabled = false;
        }
    }

    function atualizarDetalhesProdutos(doaIdOverride) {
        const selectDoacao = document.getElementById('doacaoDisponivel');
        const tbody = document.getElementById('tabelaProdutosAgendamento');
        const lista = document.getElementById('listaProdutosAgendamento');

        tbody.innerHTML = '';
        lista.style.display = 'none';

        let selectedOption;

        if (doaIdOverride) {
            selectedOption = Array.from(selectDoacao.options).find(opt => opt.value == doaIdOverride);
        } else {
            selectedOption = selectDoacao.options[selectDoacao.selectedIndex];
        }

        const detalhesJSON = selectedOption?.getAttribute('data-detalhes');

        if (detalhesJSON) {
            const detalhes = JSON.parse(detalhesJSON);
            detalhes.forEach(item => {
                tbody.innerHTML += `
                    <tr>
                        <td>${item.prod}</td>
                        <td>${item.qtde}</td>
                        <td>${item.obs || '-'}</td>
                    </tr>
                `;
            });
            lista.style.display = 'block';
        }
    }

    async function confirmarApagar() {
        const id = document.getElementById('agendamentoId').value;
        if (!id) return;

        const confirma = await UI.confirm('Tem certeza que deseja apagar este agendamento? Esta a√ß√£o √© irrevers√≠vel.');
        if (confirma) {
            try {
                const response = await fetch(`${API_BASE_URL}/agendamento/${id}`, { method: 'DELETE' });
                if (!response.ok) throw new Error('Falha no DELETE');

                UI.showAlert('Agendamento apagado com sucesso!', 'success');
                closeSidebar();
                calendarInstance.refetchEvents();
            } catch (error) {
                console.error('Erro ao apagar agendamento:', error);
                UI.showAlert('Erro ao apagar agendamento. Verifique a rota DELETE /apis/agendamento/{id}.', 'danger');
            }
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        const calendarEl = document.getElementById('calendar');
        carregarLookups();

        document.getElementById('donatarioEntrega').addEventListener('change', () => preencherEndereco('donatarioEntrega', 'enderecoEntrega', 'endereco'));
        document.getElementById('doadorRetirada').addEventListener('change', () => preencherEndereco('doadorRetirada', 'enderecoRetirada', 'local'));
        document.getElementById('tipoAgendamento').addEventListener('change', () => {
             toggleTipoAgendamento(); 
             if (document.getElementById('tipoAgendamento').value === 'entrega') {
                 preencherEndereco('donatarioEntrega', 'enderecoEntrega', 'endereco');
             } else if (document.getElementById('tipoAgendamento').value === 'retirada') {
                 preencherEndereco('doadorRetirada', 'enderecoRetirada', 'local');
             }
        });


        calendarInstance = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            locale: 'pt-br',
            editable: true,
            selectable: false,
            height: 'auto',
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay'
            },

            events: {
                url: `${API_BASE_URL}/agendamento`,
                method: 'GET',
                failure: function(error) {
                    UI.showAlert('Erro ao carregar agendamentos do servidor. Verifique a rota GET /apis/agendamento.', 'danger');
                },
                success: function(rawEvents) {
                     return Array.isArray(rawEvents) ? rawEvents : [];
                }
            },

            eventClick: function(info) {
                openSidebar(info.event.id);
            },

            eventDrop: async function(info) {
                const eventId = info.event.id;

                const confirma = await UI.confirm('Confirmar reagendamento?');

                if (confirma) {
                    try {
                        const newStart = info.event.startStr;
                        const originalProps = info.event.extendedProps; 
                        
                        const dataUpdate = {
                            agData: newStart.split('T')[0],
                            agHora: newStart.split('T')[1]?.substring(0, 5) || '09:00',
                            
                            // Campos obrigat√≥rios do Service, usando dados ORIGINAIS
                            // O Service far√° o fallback ou usar√° NULL se o ID for 0
                            volId: originalProps.volId || 0, 
                            doaId: originalProps.doaId || 0, 
                            donatarioDonId: originalProps.donatarioDonId || 0,
                            agObs: originalProps.agObs || 'Reagendado via calend√°rio'
                        };
                        
                        const response = await fetch(`${API_BASE_URL}/agendamento/${eventId}`, {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(dataUpdate)
                        });

                        if (!response.ok) throw new Error("Erro na API");

                        UI.showAlert('Agendamento reagendado com sucesso!', 'success');
                        calendarInstance.refetchEvents();
                    } catch(error) {
                        UI.showAlert('Erro ao reagendar. Desfazendo a mudan√ßa. Verifique a rota PUT /apis/agendamento/{id}.', 'danger');
                        info.revert();
                    }
                } else {
                    info.revert();
                }
            },
        });

        calendarInstance.render();
    });

    document.getElementById('formAgendarDoacao').addEventListener('submit', async function(e) {
        e.preventDefault();

        const id = document.getElementById('agendamentoId').value;
        if (!id) return;

        Validator.clearAllErrors(this);
        let isValid = Validator.validateForm(this);
        if (!isValid) return;

        try {
            const tipo = document.getElementById('tipoAgendamento').value;
            
            const data = {
                agData: document.getElementById('dataAgendamento').value,
                agHora: document.getElementById('horaAgendamento').value,
                volId: getValue('voluntarioResponsavel'),
                doaId: getValue('doacaoDisponivel'),
                agObs: document.getElementById('observacoesAgendamento').value,
                donatarioDonId: tipo === 'entrega' ? getValue('donatarioEntrega') : 0,
                doadorDoaId: tipo === 'retirada' ? getValue('doadorRetirada') : 0 
            };

            const response = await fetch(`${API_BASE_URL}/agendamento/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            if (!response.ok) throw new Error('Falha ao modificar agendamento');

            UI.showAlert('Agendamento modificado com sucesso! O calend√°rio ser√° atualizado.', 'success');
            closeSidebar();
            calendarInstance.refetchEvents();

        } catch (error) {
            console.error('Erro ao modificar agendamento:', error);
            UI.showAlert('Erro ao modificar agendamento. Verifique a rota PUT /apis/agendamento/{id} e os dados enviados.', 'danger');
        }
    });
</script>
</body>
</html>