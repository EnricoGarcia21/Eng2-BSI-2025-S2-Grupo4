<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOARC - Agendar Higieniza√ß√£o</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <a href="dashboard.html" class="logo">DOARC</a>
            <div class="user-menu">
                <span class="user-name" id="userName">Volunt√°rio</span>
                <button class="btn-logout" id="logoutBtn">Sair</button>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="nav">
        <ul class="nav-list">
            <li class="nav-item">
                <a href="dashboard.html" class="nav-link">Dashboard</a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link">Gerenciar</a>
                <ul class="submenu">
                    <li class="submenu-item"><a href="gerenciar-doadores.html" class="submenu-link">Doadores</a></li>
                    <li class="submenu-item"><a href="gerenciar-donatarios.html" class="submenu-link">Donat√°rios</a></li>
                    <li class="submenu-item"><a href="gerenciar-produtos.html" class="submenu-link">Produtos</a></li>
                    <li class="submenu-item"><a href="gerenciar-categorias.html" class="submenu-link">Categorias</a></li>
                    <li class="submenu-item"><a href="gerenciar-voluntarios.html" class="submenu-link">Volunt√°rios</a></li>
                    <li class="submenu-item"><a href="gerenciar-campanhas.html" class="submenu-link">Campanhas</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link">Doa√ß√µes</a>
                <ul class="submenu">
                    <li class="submenu-item"><a href="receber-doacoes.html" class="submenu-link">Receber Doa√ß√µes</a></li>
                    <li class="submenu-item"><a href="efetuar-doacoes.html" class="submenu-link">Efetuar Doa√ß√µes</a></li>
                    <li class="submenu-item"><a href="agendar-doacao.html" class="submenu-link">Agendar Doa√ß√£o</a></li>
                    <li class="submenu-item"><a href="agendar-retirada.html" class="submenu-link">Agendar Retirada</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link active">Estoque</a>
                <ul class="submenu">
                    <li class="submenu-item"><a href="visualizar-estoque.html" class="submenu-link">Visualizar Estoque</a></li>
                    <li class="submenu-item"><a href="registrar-acerto.html" class="submenu-link">Acerto de Estoque</a></li>
                    <li class="submenu-item"><a href="lancar-compra.html" class="submenu-link">Lan√ßar Compra/Arrecada√ß√£o</a></li>
                    <li class="submenu-item"><a href="agendar-higienizacao.html" class="submenu-link">Agendar Higieniza√ß√£o</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <a href="relatorios.html" class="nav-link">Relat√≥rios</a>
            </li>
        </ul>
    </nav>

    <!-- Main Content -->
    <main class="container">
        <div class="breadcrumb">
            <div class="breadcrumb-item"><a href="dashboard.html">Dashboard</a></div>
            <div class="breadcrumb-item">Estoque</div>
            <div class="breadcrumb-item active">Agendar Higieniza√ß√£o</div>
        </div>

        <div class="card">
            <div class="card-header">
                <h1 class="card-title">Agendar Higieniza√ß√£o de Roupas</h1>
                <p class="card-subtitle">Agende a limpeza e higieniza√ß√£o de roupas e tecidos</p>
            </div>
            <div class="card-body">
                <form id="formAgendarHigienizacao">
                    <!-- Data e Local -->
                    <h3 style="color: var(--primary-color); margin-bottom: 1rem;">Data e Local</h3>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="dataHigienizacao" class="form-label required">Data da Higieniza√ß√£o</label>
                            <input type="date" id="dataHigienizacao" class="form-control" required>
                            <div class="form-error">Data √© obrigat√≥ria</div>
                        </div>

                        <div class="form-group">
                            <label for="horaHigienizacao" class="form-label">Hor√°rio (Opcional)</label>
                            <input type="time" id="horaHigienizacao" class="form-control">
                        </div>

                        <div class="form-group">
                            <label for="periodoHigienizacao" class="form-label">Per√≠odo</label>
                            <select id="periodoHigienizacao" class="form-control form-select">
                                <option value="manha">Manh√£</option>
                                <option value="tarde">Tarde</option>
                                <option value="dia_todo">Dia Todo</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="localHigienizacao" class="form-label required">Local</label>
                        <select id="localHigienizacao" class="form-control form-select" required onchange="toggleOutroLocal()">
                            <option value="">Selecione o local</option>
                            <option value="sede">Sede da Organiza√ß√£o</option>
                            <option value="lavanderia">Lavanderia Parceira</option>
                            <option value="voluntario">Casa de Volunt√°rio</option>
                            <option value="outro">Outro Local</option>
                        </select>
                        <div class="form-error">Selecione o local</div>
                    </div>

                    <div class="form-group" id="outroLocalDiv" style="display: none;">
                        <label for="outroLocal" class="form-label required">Especifique o Local</label>
                        <input type="text" id="outroLocal" class="form-control" placeholder="Endere√ßo completo">
                    </div>

                    <!-- Produtos para Higieniza√ß√£o -->
                    <h3 style="color: var(--primary-color); margin: 2rem 0 1rem;">Roupas para Higienizar</h3>

                    <div style="background: #e8f4f8; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                        <p style="margin: 0; color: var(--primary-color);">
                            <strong>üìå Dica:</strong> Selecione apenas produtos da categoria "Roupas" dispon√≠veis no estoque
                        </p>
                    </div>

                    <!-- Filtro e Sele√ß√£o de Roupas -->
                    <div class="form-group">
                        <label class="form-label">Filtrar por Tipo:</label>
                        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                            <button type="button" class="btn btn-sm btn-outline" onclick="filtrarRoupas('todos')">Todos</button>
                            <button type="button" class="btn btn-sm btn-outline" onclick="filtrarRoupas('camisetas')">Camisetas</button>
                            <button type="button" class="btn btn-sm btn-outline" onclick="filtrarRoupas('calcas')">Cal√ßas</button>
                            <button type="button" class="btn btn-sm btn-outline" onclick="filtrarRoupas('agasalhos')">Agasalhos</button>
                            <button type="button" class="btn btn-sm btn-outline" onclick="filtrarRoupas('outros')">Outros</button>
                        </div>
                    </div>

                    <!-- Lista de Roupas Dispon√≠veis -->
                    <div style="border: 1px solid #ddd; border-radius: 8px; padding: 1rem; max-height: 400px; overflow-y: auto; margin-bottom: 1.5rem;">
                        <h4 style="margin-top: 0; color: var(--primary-color);">Selecione as Roupas:</h4>
                        <div id="listaRoupas">
                            <label class="form-label" style="display: block; padding: 0.5rem; border-bottom: 1px solid #eee;" data-tipo="camisetas">
                                <input type="checkbox" class="checkbox-roupa" value="1" data-nome="Camisetas Tamanho M" data-quantidade="40">
                                Camisetas Tamanho M <span style="color: #666;">(40 unidades)</span>
                            </label>
                            <label class="form-label" style="display: block; padding: 0.5rem; border-bottom: 1px solid #eee;" data-tipo="camisetas">
                                <input type="checkbox" class="checkbox-roupa" value="2" data-nome="Camisetas Tamanho G" data-quantidade="35">
                                Camisetas Tamanho G <span style="color: #666;">(35 unidades)</span>
                            </label>
                            <label class="form-label" style="display: block; padding: 0.5rem; border-bottom: 1px solid #eee;" data-tipo="calcas">
                                <input type="checkbox" class="checkbox-roupa" value="3" data-nome="Cal√ßas Jeans Tamanho 40" data-quantidade="25">
                                Cal√ßas Jeans Tamanho 40 <span style="color: #666;">(25 unidades)</span>
                            </label>
                            <label class="form-label" style="display: block; padding: 0.5rem; border-bottom: 1px solid #eee;" data-tipo="calcas">
                                <input type="checkbox" class="checkbox-roupa" value="4" data-nome="Cal√ßas Jeans Tamanho 42" data-quantidade="30">
                                Cal√ßas Jeans Tamanho 42 <span style="color: #666;">(30 unidades)</span>
                            </label>
                            <label class="form-label" style="display: block; padding: 0.5rem; border-bottom: 1px solid #eee;" data-tipo="agasalhos">
                                <input type="checkbox" class="checkbox-roupa" value="5" data-nome="Agasalhos de Frio" data-quantidade="20">
                                Agasalhos de Frio <span style="color: #666;">(20 unidades)</span>
                            </label>
                            <label class="form-label" style="display: block; padding: 0.5rem; border-bottom: 1px solid #eee;" data-tipo="agasalhos">
                                <input type="checkbox" class="checkbox-roupa" value="6" data-nome="Jaquetas" data-quantidade="15">
                                Jaquetas <span style="color: #666;">(15 unidades)</span>
                            </label>
                            <label class="form-label" style="display: block; padding: 0.5rem; border-bottom: 1px solid #eee;" data-tipo="outros">
                                <input type="checkbox" class="checkbox-roupa" value="7" data-nome="Cobertores" data-quantidade="18">
                                Cobertores <span style="color: #666;">(18 unidades)</span>
                            </label>
                            <label class="form-label" style="display: block; padding: 0.5rem;" data-tipo="outros">
                                <input type="checkbox" class="checkbox-roupa" value="8" data-nome="Toalhas" data-quantidade="22">
                                Toalhas <span style="color: #666;">(22 unidades)</span>
                            </label>
                        </div>
                    </div>

                    <div style="background: #fff3cd; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
                        <strong>Itens Selecionados:</strong> <span id="totalSelecionados">0</span> tipo(s) de roupa
                    </div>

                    <!-- Respons√°vel -->
                    <h3 style="color: var(--primary-color); margin: 2rem 0 1rem;">Respons√°vel</h3>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="voluntarioResponsavel" class="form-label required">Volunt√°rio Respons√°vel</label>
                            <select id="voluntarioResponsavel" class="form-control form-select" required>
                                <option value="">Selecione um volunt√°rio</option>
                                <option value="1">Jo√£o Silva</option>
                                <option value="2">Maria Santos</option>
                                <option value="3">Pedro Oliveira</option>
                                <option value="4">Ana Costa</option>
                            </select>
                            <div class="form-error">Selecione o respons√°vel</div>
                        </div>

                        <div class="form-group">
                            <label for="telefoneContato" class="form-label">Telefone de Contato</label>
                            <input type="tel" id="telefoneContato" class="form-control" data-mask="phone" placeholder="(18) 99999-9999">
                        </div>
                    </div>

                    <!-- Detalhes da Higieniza√ß√£o -->
                    <h3 style="color: var(--primary-color); margin: 2rem 0 1rem;">Detalhes da Higieniza√ß√£o</h3>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="tipoHigienizacao" class="form-label">Tipo de Higieniza√ß√£o</label>
                            <select id="tipoHigienizacao" class="form-control form-select">
                                <option value="lavagem">Lavagem Simples</option>
                                <option value="lavagem_seco">Lavagem a Seco</option>
                                <option value="higienizacao">Higieniza√ß√£o Completa</option>
                                <option value="desinfeccao">Desinfec√ß√£o</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="custoEstimado" class="form-label">Custo Estimado (R$)</label>
                            <input type="number" id="custoEstimado" class="form-control" step="0.01" min="0" placeholder="0,00">
                            <div class="form-text">Opcional - apenas se houver custo</div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="observacoes" class="form-label">Observa√ß√µes</label>
                        <textarea id="observacoes" class="form-control" rows="3" placeholder="Instru√ß√µes especiais, cuidados necess√°rios, etc..."></textarea>
                    </div>

                    <div class="card-footer">
                        <div class="btn-group">
                            <button type="button" class="btn btn-outline" onclick="window.location.href='visualizar-estoque.html'">
                                Cancelar
                            </button>
                            <button type="submit" class="btn btn-success">
                                ‚úì Agendar Higieniza√ß√£o
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Lista de Higieniza√ß√µes Agendadas -->
        <div class="card" style="margin-top: 2rem;">
            <div class="card-header">
                <h2 class="card-title">Higieniza√ß√µes Agendadas</h2>
            </div>
            <div class="card-body">
                <div class="table-container">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Local</th>
                                <th>Quantidade de Itens</th>
                                <th>Respons√°vel</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="tabelaHigienizacoes">
                            <tr>
                                <td>20/10/2025</td>
                                <td>Lavanderia Parceira</td>
                                <td>5 tipos (120 pe√ßas)</td>
                                <td>Maria Santos</td>
                                <td><span class="badge badge-warning">Agendado</span></td>
                                <td>
                                    <button class="btn btn-sm btn-info" onclick="verDetalhes(1)" title="Ver detalhes">üëÅÔ∏è</button>
                                    <button class="btn btn-sm btn-success" onclick="concluir(1)" title="Concluir">‚úì</button>
                                    <button class="btn btn-sm btn-danger" onclick="cancelar(1)" title="Cancelar">‚úó</button>
                                </td>
                            </tr>
                            <tr>
                                <td>18/10/2025</td>
                                <td>Sede da Organiza√ß√£o</td>
                                <td>3 tipos (80 pe√ßas)</td>
                                <td>Jo√£o Silva</td>
                                <td><span class="badge badge-warning">Agendado</span></td>
                                <td>
                                    <button class="btn btn-sm btn-info" onclick="verDetalhes(2)" title="Ver detalhes">üëÅÔ∏è</button>
                                    <button class="btn btn-sm btn-success" onclick="concluir(2)" title="Concluir">‚úì</button>
                                    <button class="btn btn-sm btn-danger" onclick="cancelar(2)" title="Cancelar">‚úó</button>
                                </td>
                            </tr>
                            <tr>
                                <td>12/10/2025</td>
                                <td>Casa de Volunt√°rio</td>
                                <td>2 tipos (45 pe√ßas)</td>
                                <td>Ana Costa</td>
                                <td><span class="badge badge-success">Conclu√≠do</span></td>
                                <td>
                                    <button class="btn btn-sm btn-info" onclick="verDetalhes(3)" title="Ver detalhes">üëÅÔ∏è</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <script src="../js/app.js"></script>
    <script>
        // Definir data m√≠nima como hoje
        const hoje = new Date().toISOString().split('T')[0];
        document.getElementById('dataHigienizacao').min = hoje;
        document.getElementById('dataHigienizacao').value = hoje;

        // Contador de selecionados
        document.querySelectorAll('.checkbox-roupa').forEach(checkbox => {
            checkbox.addEventListener('change', atualizarContador);
        });

        function atualizarContador() {
            const selecionados = document.querySelectorAll('.checkbox-roupa:checked').length;
            document.getElementById('totalSelecionados').textContent = selecionados;
        }

        function toggleOutroLocal() {
            const local = document.getElementById('localHigienizacao').value;
            const outroLocalDiv = document.getElementById('outroLocalDiv');
            outroLocalDiv.style.display = local === 'outro' ? 'block' : 'none';
        }

        function filtrarRoupas(tipo) {
            const labels = document.querySelectorAll('#listaRoupas label');

            labels.forEach(label => {
                if (tipo === 'todos') {
                    label.style.display = 'block';
                } else {
                    const tipoRoupa = label.getAttribute('data-tipo');
                    label.style.display = tipoRoupa === tipo ? 'block' : 'none';
                }
            });
        }

        function verDetalhes(id) {
            UI.showAlert('Funcionalidade em desenvolvimento', 'info');
        }

        function concluir(id) {
            UI.confirm('Marcar esta higieniza√ß√£o como conclu√≠da?', async function() {
                // TODO: await API.put(`/higienizacoes/${id}/concluir`);
                UI.showAlert('Higieniza√ß√£o marcada como conclu√≠da!', 'success');
            });
        }

        function cancelar(id) {
            UI.confirm('Cancelar esta higieniza√ß√£o agendada?', async function() {
                // TODO: await API.put(`/higienizacoes/${id}/cancelar`);
                UI.showAlert('Higieniza√ß√£o cancelada!', 'success');
            });
        }

        // Submiss√£o do formul√°rio
        document.getElementById('formAgendarHigienizacao').addEventListener('submit', async function(e) {
            e.preventDefault();

            const dataHigienizacao = document.getElementById('dataHigienizacao');
            const localHigienizacao = document.getElementById('localHigienizacao');
            const voluntarioResponsavel = document.getElementById('voluntarioResponsavel');

            Validator.clearAllErrors(this);
            let isValid = true;

            if (!dataHigienizacao.value) {
                Validator.showError(dataHigienizacao, 'Informe a data');
                isValid = false;
            }

            if (!localHigienizacao.value) {
                Validator.showError(localHigienizacao, 'Selecione o local');
                isValid = false;
            }

            if (localHigienizacao.value === 'outro') {
                const outroLocal = document.getElementById('outroLocal');
                if (!outroLocal.value) {
                    Validator.showError(outroLocal, 'Especifique o local');
                    isValid = false;
                }
            }

            if (!voluntarioResponsavel.value) {
                Validator.showError(voluntarioResponsavel, 'Selecione o respons√°vel');
                isValid = false;
            }

            // Verificar se pelo menos uma roupa foi selecionada
            const roupasSelecionadas = [];
            document.querySelectorAll('.checkbox-roupa:checked').forEach(checkbox => {
                roupasSelecionadas.push({
                    produtoId: checkbox.value,
                    nome: checkbox.getAttribute('data-nome'),
                    quantidade: checkbox.getAttribute('data-quantidade')
                });
            });

            if (roupasSelecionadas.length === 0) {
                UI.showAlert('Selecione pelo menos uma roupa para higienizar', 'warning');
                isValid = false;
            }

            if (!isValid) return;

            try {
                const data = {
                    data: dataHigienizacao.value,
                    hora: document.getElementById('horaHigienizacao').value,
                    periodo: document.getElementById('periodoHigienizacao').value,
                    local: localHigienizacao.value === 'outro'
                        ? document.getElementById('outroLocal').value
                        : localHigienizacao.options[localHigienizacao.selectedIndex].text,
                    voluntarioId: voluntarioResponsavel.value,
                    telefoneContato: document.getElementById('telefoneContato').value,
                    roupas: roupasSelecionadas,
                    tipoHigienizacao: document.getElementById('tipoHigienizacao').value,
                    custoEstimado: parseFloat(document.getElementById('custoEstimado').value) || 0,
                    observacoes: document.getElementById('observacoes').value
                };

                // TODO: Integrar com API
                // await API.post('/higienizacoes', data);

                UI.showAlert('Higieniza√ß√£o agendada com sucesso!', 'success');

                setTimeout(() => {
                    window.location.reload();
                }, 2000);

            } catch (error) {
                console.error('Erro ao agendar higieniza√ß√£o:', error);
            }
        });

        // Aplicar m√°scaras
        Masks.init();
    </script>
</body>
</html>
