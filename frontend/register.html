<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOARC - Cadastro de Voluntário</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* Estilos para garantir funcionamento */
        .login-container { display: flex; justify-content: center; align-items: center; min-height: 100vh; background: #f5f5f5; padding: 1rem; }
        .login-card { background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); width: 100%; }
        .login-header { text-align: center; margin-bottom: 2rem; }
        .login-title { margin: 0; color: #333; }
        .login-subtitle { margin: 0.5rem 0 0 0; color: #666; }
        .form-row { display: flex; gap: 1rem; margin-bottom: 1rem; }
        .form-group { flex: 1; }
        .form-label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: #333; }
        .required::after { content: " *"; color: red; }
        .form-control { width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        .form-error { color: red; font-size: 0.875rem; margin-top: 0.25rem; display: none; }
        .btn { padding: 0.75rem 1.5rem; border: none; border-radius: 4px; cursor: pointer; font-size: 1rem; }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-primary:hover { background-color: #0056b3; }
        .text-center { text-align: center; }
    </style>
</head>
<body>
    <div class="login-container">
        <div class="login-card" style="max-width: 600px;">
            <div class="login-header">
                <h1 class="login-title">Cadastro de Voluntário</h1>
                <p class="login-subtitle">Preencha os dados para criar sua conta</p>
            </div>

            <form id="registerForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="nome" class="form-label required">Nome Completo</label>
                        <input
                            type="text"
                            id="nome"
                            class="form-control"
                            placeholder="Digite seu nome completo"
                            required
                        >
                        <div class="form-error">Nome é obrigatório</div>
                    </div>

                    <div class="form-group">
                        <label for="cpf" class="form-label required">CPF</label>
                        <input
                            type="text"
                            id="cpf"
                            class="form-control"
                            placeholder="000.000.000-00"
                            required
                        >
                        <div class="form-error">CPF inválido</div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="email" class="form-label required">E-mail</label>
                        <input
                            type="email"
                            id="email"
                            class="form-control"
                            placeholder="seu@email.com"
                            required
                        >
                        <div class="form-error">E-mail inválido</div>
                    </div>

                    <div class="form-group">
                        <label for="telefone" class="form-label required">Telefone</label>
                        <input
                            type="tel"
                            id="telefone"
                            class="form-control"
                            placeholder="(00) 00000-0000"
                            required
                        >
                        <div class="form-error">Telefone inválido</div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="dataNascimento" class="form-label required">Data de Nascimento</label>
                        <input
                            type="date"
                            id="dataNascimento"
                            class="form-control"
                            required
                        >
                        <div class="form-error">Data de nascimento é obrigatória</div>
                    </div>

                    <div class="form-group">
                        <label for="sexo" class="form-label required">Sexo</label>
                        <select id="sexo" class="form-control" required>
                            <option value="">Selecione</option>
                            <option value="M">Masculino</option>
                            <option value="F">Feminino</option>
                        </select>
                        <div class="form-error">Sexo é obrigatório</div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="rua" class="form-label">Rua</label>
                        <input
                            type="text"
                            id="rua"
                            class="form-control"
                            placeholder="Nome da rua"
                        >
                    </div>

                    <div class="form-group">
                        <label for="numero" class="form-label">Número</label>
                        <input
                            type="text"
                            id="numero"
                            class="form-control"
                            placeholder="Número"
                        >
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="bairro" class="form-label">Bairro</label>
                        <input
                            type="text"
                            id="bairro"
                            class="form-control"
                            placeholder="Bairro"
                        >
                    </div>

                    <div class="form-group">
                        <label for="cidade" class="form-label">Cidade</label>
                        <input
                            type="text"
                            id="cidade"
                            class="form-control"
                            placeholder="Cidade"
                        >
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="cep" class="form-label">CEP</label>
                        <input
                            type="text"
                            id="cep"
                            class="form-control"
                            placeholder="00000-000"
                        >
                    </div>

                    <div class="form-group">
                        <label for="uf" class="form-label">UF</label>
                        <select id="uf" class="form-control">
                            <option value="">Selecione</option>
                            <option value="SP">SP</option>
                            <option value="RJ">RJ</option>
                            <option value="MG">MG</option>
                            <!-- outros estados -->
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="password" class="form-label required">Senha</label>
                        <input
                            type="password"
                            id="password"
                            class="form-control"
                            placeholder="Mínimo 6 caracteres"
                            required
                        >
                        <div class="form-error">Senha deve ter no mínimo 6 caracteres</div>
                    </div>

                    <div class="form-group">
                        <label for="confirmPassword" class="form-label required">Confirmar Senha</label>
                        <input
                            type="password"
                            id="confirmPassword"
                            class="form-control"
                            placeholder="Digite a senha novamente"
                            required
                        >
                        <div class="form-error">As senhas não coincidem</div>
                    </div>
                </div>

                <div class="form-group">
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        Cadastrar
                    </button>
                </div>

                <div class="text-center">
                    <p style="margin-top: 1rem; color: #666;">
                        Já tem uma conta?
                        <a href="index.html" style="color: #007bff; text-decoration: none; font-weight: 500;">
                            Faça login aqui
                        </a>
                    </p>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Simulação das funções UI e Validator
        const UI = {
            showAlert: (message, type) => {
                alert(`${type.toUpperCase()}: ${message}`);
            }
        };

        const Validator = {
            isEmpty: (value) => !value || value.trim() === '',
            isValidCPF: (cpf) => {
                const cleanCPF = cpf.replace(/[^\d]/g, '');
                return cleanCPF.length === 11;
            },
            isValidEmail: (email) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email),
            isValidPhone: (phone) => {
                const cleanPhone = phone.replace(/[^\d]/g, '');
                return cleanPhone.length >= 10 && cleanPhone.length <= 11;
            },
            showError: (input, message) => {
                let errorElement = input.nextElementSibling;
                if (!errorElement || !errorElement.classList.contains('form-error')) {
                    errorElement = document.createElement('div');
                    errorElement.className = 'form-error';
                    input.parentNode.insertBefore(errorElement, input.nextSibling);
                }
                errorElement.textContent = message;
                errorElement.style.display = 'block';
                input.style.borderColor = 'red';
            },
            clearAllErrors: (form) => {
                const errors = form.querySelectorAll('.form-error');
                const inputs = form.querySelectorAll('input, select');
                errors.forEach(error => error.style.display = 'none');
                inputs.forEach(input => input.style.borderColor = '');
            }
        };

        document.getElementById('registerForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const nome = document.getElementById('nome');
            const cpf = document.getElementById('cpf');
            const email = document.getElementById('email');
            const telefone = document.getElementById('telefone');
            const dataNascimento = document.getElementById('dataNascimento');
            const sexo = document.getElementById('sexo');
            const rua = document.getElementById('rua');
            const numero = document.getElementById('numero');
            const bairro = document.getElementById('bairro');
            const cidade = document.getElementById('cidade');
            const cep = document.getElementById('cep');
            const uf = document.getElementById('uf');
            const password = document.getElementById('password');
            const confirmPassword = document.getElementById('confirmPassword');

            // Limpa erros anteriores
            Validator.clearAllErrors(this);

            // Validações
            let isValid = true;

            if (Validator.isEmpty(nome.value)) {
                Validator.showError(nome, 'Nome é obrigatório');
                isValid = false;
            }

            if (Validator.isEmpty(cpf.value)) {
                Validator.showError(cpf, 'CPF é obrigatório');
                isValid = false;
            } else if (!Validator.isValidCPF(cpf.value)) {
                Validator.showError(cpf, 'CPF inválido');
                isValid = false;
            }

            if (Validator.isEmpty(email.value)) {
                Validator.showError(email, 'E-mail é obrigatório');
                isValid = false;
            } else if (!Validator.isValidEmail(email.value)) {
                Validator.showError(email, 'E-mail inválido');
                isValid = false;
            }

            if (Validator.isEmpty(telefone.value)) {
                Validator.showError(telefone, 'Telefone é obrigatório');
                isValid = false;
            } else if (!Validator.isValidPhone(telefone.value)) {
                Validator.showError(telefone, 'Telefone inválido');
                isValid = false;
            }

            if (Validator.isEmpty(dataNascimento.value)) {
                Validator.showError(dataNascimento, 'Data de nascimento é obrigatória');
                isValid = false;
            }

            if (Validator.isEmpty(sexo.value)) {
                Validator.showError(sexo, 'Sexo é obrigatório');
                isValid = false;
            }

            if (Validator.isEmpty(password.value)) {
                Validator.showError(password, 'Senha é obrigatória');
                isValid = false;
            } else if (password.value.length < 6) {
                Validator.showError(password, 'Senha deve ter no mínimo 6 caracteres');
                isValid = false;
            }

            if (password.value !== confirmPassword.value) {
                Validator.showError(confirmPassword, 'As senhas não coincidem');
                isValid = false;
            }

            if (!isValid) return;

            try {
                const response = await fetch('http://localhost:8080/api/acesso/registrar', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        nome: nome.value,
                        cpf: cpf.value.replace(/[^\d]/g, ''),
                        email: email.value,
                        telefone: telefone.value.replace(/[^\d]/g, ''),
                        dataNascimento: dataNascimento.value,
                        sexo: sexo.value,
                        rua: rua.value,
                        numero: numero.value,
                        bairro: bairro.value,
                        cidade: cidade.value,
                        cep: cep.value,
                        uf: uf.value,
                        senha: password.value
                    })
                });

                const resultado = await response.json();

                if (response.ok) {
                    UI.showAlert(resultado.mensagem || 'Cadastro realizado com sucesso! Redirecionando...', 'success');

                    // Redireciona após 2 segundos
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 2000);
                } else {
                    UI.showAlert('Erro: ' + (resultado.mensagem || 'Erro ao realizar cadastro'), 'error');
                }

            } catch (error) {
                console.error('Erro:', error);
                UI.showAlert('Erro ao realizar cadastro. Tente novamente.', 'error');
            }
        });

        // Máscaras simples
        document.getElementById('cpf').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 11) {
                value = value.replace(/(\d{3})(\d)/, '$1.$2')
                           .replace(/(\d{3})(\d)/, '$1.$2')
                           .replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            }
            e.target.value = value;
        });

        document.getElementById('telefone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 11) {
                value = value.replace(/(\d{2})(\d)/, '($1) $2')
                           .replace(/(\d{5})(\d)/, '$1-$2');
            }
            e.target.value = value;
        });

        document.getElementById('cep').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 8) {
                value = value.replace(/(\d{5})(\d)/, '$1-$2');
            }
            e.target.value = value;
        });
    </script>
</body>
</html>